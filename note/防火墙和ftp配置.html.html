<html>
<head>
  <title>防火墙和ftp配置.html</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/306387 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="761"/>
<h1>防火墙和ftp配置.html</h1>

<div>
<span><div>现在好了里,虽然我不怎么明白,感谢   <a href="http://my.oschina.net/leo108" target="_blank">@leo108</a> , <a href="http://my.oschina.net/u/991956" target="_blank">@wy821027</a> , <a href="http://my.oschina.net/lvfifi" target="_blank">@淡定的wo</a><br/>
现在贴出iptables配置和vsftpd配置<br/><p>iptables配置</p><div><div><a href="http://www.oschina.net/question/723831_223753#">?</a></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td><div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>10</div><div>11</div><div>12</div><div>13</div><div>14</div><div>15</div><div>16</div><div>17</div><div>18</div></td><td><div><code># Generated by iptables-save v1.4.7 on Fri Jan 23 22:44:41 2015</code></div><div><code>*filter</code></div><div><code>:INPUT ACCEPT [0:0]</code></div><div><code>:FORWARD ACCEPT [0:0]</code></div><div><code>:OUTPUT ACCEPT [5:605]</code></div><div><code>-A INPUT -p tcp -m tcp --dport 20 -j ACCEPT</code></div><div><code>-A INPUT -p tcp -m tcp --dport 21 -j ACCEPT</code></div><div><code>-A INPUT -p tcp -m tcp --dport 80 -j ACCEPT</code></div><div><code>-A INPUT -p tcp -m tcp --dport 3306 -j ACCEPT</code></div><div><code>-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT</code></div><div><code>-A INPUT -p icmp -j ACCEPT</code></div><div><code>-A INPUT -i lo -j ACCEPT</code></div><div><code>-A INPUT -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT</code></div><div><code>-A INPUT -p tcp -m multiport --dports 40000:40080 -j ACCEPT</code></div><div><code>-A INPUT -j REJECT --reject-with icmp-host-prohibited</code></div><div><code>-A FORWARD -j REJECT --reject-with icmp-host-prohibited</code></div><div><code>COMMIT</code></div><div><code># Completed on Fri Jan 23 22:44:41 2015</code></div></td></tr></tbody></table></div><p><br/></p><p><br/></p>
vsftpd.conf
<div><div><a href="http://www.oschina.net/question/723831_223753#">?</a></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td><div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>10</div><div>11</div><div>12</div><div>13</div><div>14</div><div>15</div><div>16</div><div>17</div><div>18</div><div>19</div><div>20</div><div>21</div><div>22</div><div>23</div><div>24</div><div>25</div><div>26</div><div>27</div><div>28</div><div>29</div><div>30</div><div>31</div><div>32</div><div>33</div><div>34</div><div>35</div><div>36</div><div>37</div><div>38</div><div>39</div><div>40</div><div>41</div><div>42</div><div>43</div><div>44</div><div>45</div><div>46</div><div>47</div><div>48</div><div>49</div><div>50</div><div>51</div><div>52</div><div>53</div><div>54</div><div>55</div><div>56</div><div>57</div><div>58</div><div>59</div><div>60</div><div>61</div><div>62</div><div>63</div><div>64</div><div>65</div><div>66</div><div>67</div><div>68</div><div>69</div><div>70</div><div>71</div><div>72</div><div>73</div><div>74</div><div>75</div><div>76</div><div>77</div><div>78</div><div>79</div><div>80</div><div>81</div><div>82</div><div>83</div><div>84</div><div>85</div><div>86</div><div>87</div><div>88</div><div>89</div><div>90</div><div>91</div><div>92</div><div>93</div><div>94</div><div>95</div><div>96</div><div>97</div><div>98</div><div>99</div><div>100</div><div>101</div><div>102</div><div>103</div><div>104</div><div>105</div><div>106</div><div>107</div><div>108</div><div>109</div><div>110</div><div>111</div><div>112</div><div>113</div><div>114</div><div>115</div><div>116</div><div>117</div><div>118</div><div>119</div><div>120</div><div>121</div><div>122</div><div>123</div><div>124</div><div>125</div><div>126</div><div>127</div><div>128</div></td><td><div><div><code># Example config file /etc/vsftpd/vsftpd.conf</code></div><div><code>#</code></div><div><code># The default compiled in settings are fairly paranoid. This sample file</code></div><div><code># loosens things up a bit, to make the ftp daemon more usable.</code></div><div><code># Please see vsftpd.conf.5 for all compiled in defaults.</code></div><div><code>#</code></div><div><code># READ THIS: This example file is NOT an exhaustive list of vsftpd options.</code></div><div><code># Please read the vsftpd.conf.5 manual page to get a full idea of vsftpd's</code></div><div><code># capabilities.</code></div><div><code>#</code></div><div><code># Allow anonymous FTP? (Beware - allowed by default if you comment this out).</code></div><div><code>anonymous_enable=YES</code></div><div><code>#</code></div><div><code># Uncomment this to allow local users to log in.</code></div><div><code>local_enable=YES</code></div><div><code>#</code></div><div><code># Uncomment this to enable any form of FTP write command.</code></div><div><code>write_enable=YES</code></div><div><code>#</code></div><div><code># Default umask for local users is 077. You may wish to change this to 022,</code></div><div><code># if your users expect that (022 is used by most other ftpd's)</code></div><div><code>local_umask=022</code></div><div><code>#</code></div><div><code># Uncomment this to allow the anonymous FTP user to upload files. This only</code></div><div><code># has an effect if the above global write enable is activated. Also, you will</code></div><div><code># obviously need to create a directory writable by the FTP user.</code></div><div><code>#anon_upload_enable=YES</code></div><div><code>#</code></div><div><code># Uncomment this if you want the anonymous FTP user to be able to create</code></div><div><code># new directories.</code></div><div><code>#anon_mkdir_write_enable=YES</code></div><div><code>#</code></div><div><code># Activate directory messages - messages given to remote users when they</code></div><div><code># go into a certain directory.</code></div><div><code>dirmessage_enable=YES</code></div><div><code>#</code></div><div><code># The target log file can be vsftpd_log_file or xferlog_file.</code></div><div><code># This depends on setting xferlog_std_format parameter</code></div><div><code>xferlog_enable=YES</code></div><div><code>#</code></div><div><code># Make sure PORT transfer connections originate from port 20 (ftp-data).</code></div><div><code>connect_from_port_20=YES</code></div><div><code>#</code></div><div><code># If you want, you can arrange for uploaded anonymous files to be owned by</code></div><div><code># a different user. Note! Using &quot;root&quot; for uploaded files is not</code></div><div><code># recommended!</code></div><div><code>#chown_uploads=YES</code></div><div><code>#chown_username=whoever</code></div><div><code>#</code></div><div><code># The name of log file when xferlog_enable=YES and xferlog_std_format=YES</code></div><div><code># WARNING - changing this filename affects /etc/logrotate.d/vsftpd.log</code></div><div><code>#xferlog_file=/var/log/xferlog</code></div><div><code>#</code></div><div><code># Switches between logging into vsftpd_log_file and xferlog_file files.</code></div><div><code># NO writes to vsftpd_log_file, YES to xferlog_file</code></div><div><code>xferlog_std_format=YES</code></div><div><code>#</code></div><div><code># You may change the default value for timing out an idle session.</code></div><div><code>#idle_session_timeout=600</code></div><div><code>#</code></div><div><code># You may change the default value for timing out a data connection.</code></div><div><code>#data_connection_timeout=120</code></div><div><code>#</code></div><div><code># It is recommended that you define on your system a unique user which the</code></div><div><code># ftp server can use as a totally isolated and unprivileged user.</code></div><div><code>#nopriv_user=ftpsecure</code></div><div><code>#</code></div><div><code># Enable this and the server will recognise asynchronous ABOR requests. Not</code></div><div><code># recommended for security (the code is non-trivial). Not enabling it,</code></div><div><code># however, may confuse older FTP clients.</code></div><div><code>#async_abor_enable=YES</code></div><div><code>#</code></div><div><code># By default the server will pretend to allow ASCII mode but in fact ignore</code></div><div><code># the request. Turn on the below options to have the server actually do ASCII</code></div><div><code># mangling on files when in ASCII mode.</code></div><div><code># Beware that on some FTP servers, ASCII support allows a denial of service</code></div><div><code># attack (DoS) via the command &quot;SIZE /big/file&quot; in ASCII mode. vsftpd</code></div><div><code># predicted this attack and has always been safe, reporting the size of the</code></div><div><code># raw file.</code></div><div><code># ASCII mangling is a horrible feature of the protocol.</code></div><div><code>#ascii_upload_enable=YES</code></div><div><code>#ascii_download_enable=YES</code></div><div><code>#</code></div><div><code># You may fully customise the login banner string:</code></div><div><code>#ftpd_banner=Welcome to blah FTP service.</code></div><div><code>#</code></div><div><code># You may specify a file of disallowed anonymous e-mail addresses. Apparently</code></div><div><code># useful for combatting certain DoS attacks.</code></div><div><code>#deny_email_enable=YES</code></div><div><code># (default follows)</code></div><div><code>#banned_email_file=/etc/vsftpd/banned_emails</code></div><div><code>#</code></div><div><code># You may specify an explicit list of local users to chroot() to their home</code></div><div><code># directory. If chroot_local_user is YES, then this list becomes a list of</code></div><div><code># users to NOT chroot().</code></div><div><code>#chroot_local_user=YES</code></div><div><code>#chroot_list_enable=YES</code></div><div><code># (default follows)</code></div><div><code>#chroot_list_file=/etc/vsftpd/chroot_list</code></div><div><code>#</code></div><div><code># You may activate the &quot;-R&quot; option to the builtin ls. This is disabled by</code></div><div><code># default to avoid remote users being able to cause excessive I/O on large</code></div><div><code># sites. However, some broken FTP clients such as &quot;ncftp&quot; and &quot;mirror&quot; assume</code></div><div><code># the presence of the &quot;-R&quot; option, so there is a strong case for enabling it.</code></div><div><code>#ls_recurse_enable=YES</code></div><div><code>#</code></div><div><code># When &quot;listen&quot; directive is enabled, vsftpd runs in standalone mode and</code></div><div><code># listens on IPv4 sockets. This directive cannot be used in conjunction</code></div><div><code># with the listen_ipv6 directive.</code></div><div><code>listen=YES</code></div><div><code>#</code></div><div><code># This directive enables listening on IPv6 sockets. To listen on IPv4 and IPv6</code></div><div><code># sockets, you must run two copies of vsftpd with two configuration files.</code></div><div><code># Make sure, that one of the listen options is commented !!</code></div><div><code>#listen_ipv6=YES</code></div><div> </div><div><code>pam_service_name=vsftpd</code></div><div><code>userlist_enable=YES</code></div><div><code>tcp_wrappers=YES</code></div><div><code>userlist_deny=NO</code></div><div><code>local_root=</code><code>/var/www</code></div><div><code>tcp_wrappers=YES</code></div><div><code>use_localtime=YES</code></div><div><code>pasv_enable=YES</code></div><div><code>pasv_min_port=40000</code></div><div><code>#最大端口号</code></div><div><code>pasv_max_port=40080</code></div><div><code>pasv_promiscuous=YES</code></div><br/><div style="color:gray"><small>来源： <a href="http://www.oschina.net/question/723831_223753">http://www.oschina.net/question/723831_223753</a></small></div></div></td></tr></tbody></table></div></div></span>
</div></body></html> 