<html>
<head>
  <title>(精)高手不得不会的东西--HttpServletRequestWrapper、HttpS.html</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/306387 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="515"/>
<h1>(精)高手不得不会的东西--HttpServletRequestWrapper、HttpS.html</h1>

<div>
<span><h1><a name="458">(精)高手不得不会的东西--HttpServletRequestWrapper、HttpServletResponseWrapper,HttpSessionWr</a></h1><div><a name="458"></a><div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><a name="458"></a><div style="background-color: rgb(255, 255, 255); font-family: 'Microsoft YaHei'; font-size: 20px;"><a name="458"></a><a href="http://blog.csdn.net/it_man/article/details/7556903" style="color: rgb(0, 0, 0);">(精)高手不得不会的东西--HttpServletRequestWrapper、HttpServletResponseWrapper,HttpSessionWrapper用法</a></div><div style="background-color: rgb(255, 255, 255); color: rgb(153, 153, 153); font-family: Arial; font-size: 12px;">分类： <a href="http://blog.csdn.net/it_man/article/category/204147" style="color:rgb(51, 102, 153);">JAVA</a>2012-05-11 12:51 <span title="阅读次数">1456人阅读</span> <span title="评论次数"><a href="http://blog.csdn.net/it_man/article/details/7556903#comments" style="color:rgb(51, 102, 153);">评论</a>(0)</span> <a style="color:rgb(51, 102, 153);" title="收藏">收藏</a> <a href="http://blog.csdn.net/it_man/article/details/7556903#report" style="color:rgb(51, 102, 153);" title="举报">举报</a></div><div style="background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: Arial, Console, Verdana, 'Courier New'; font-size: 12px;"><a href="http://www.csdn.net/tag/string" style="background-color:rgb(238, 238, 238);color:rgb(51, 102, 153);" target="_blank">string</a><a href="http://www.csdn.net/tag/oracle10g" style="background-color:rgb(238, 238, 238);color:rgb(51, 102, 153);" target="_blank">oracle10g</a><a href="http://www.csdn.net/tag/output" style="background-color:rgb(238, 238, 238);color:rgb(51, 102, 153);" target="_blank">output</a><a href="http://www.csdn.net/tag/wrapper" style="background-color:rgb(238, 238, 238);color:rgb(51, 102, 153);" target="_blank">wrapper</a><a href="http://www.csdn.net/tag/soa" style="background-color:rgb(238, 238, 238);color:rgb(51, 102, 153);" target="_blank">soa</a><a href="http://www.csdn.net/tag/session" style="background-color:rgb(238, 238, 238);color:rgb(51, 102, 153);" target="_blank">session</a></div><div style="background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: Arial;"><div><span style="font-family:Helvetica, Tahoma, Arial, sans-serif;font-size:18px;"><span style="font-size:14px;">高手不得不会的东西</span></span></div><div><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><br/></span></div><div><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">背景：项目使用的SOA架构，使用Oracle10G SOA SUITE，在该套件中增加了一个过滤器用于解析设置的访问策略。在其中遇到了一个问题，Oracle10g无法将IP与实例编号进行绑定，于是乎从过滤器入手，尝试了HttpServletRequestWrapper、HttpServletResponseWrapper拦截设置参数的方法。得到的结果request可以对请求参数进行修改，但是这样可能会导致Oracle10g SOA Suite的正常运行，想从response中获得返回的内容，但是得到的结果是null，到目前为止该问题仍旧没有得到解决，有好办法的欢迎联系本人，谢谢。 <br/><br/></span></div><div><table><tbody><tr><td style="font-size: 12px;"><div style="color: rgb(51, 51, 51); font-size: 14px;"><p>1）建立一个响应包装器。扩展javax.servlet.http.HttpServletResponseWrapper。</p><p>2）提供一个缓存输出的PrintWriter。重载getWriter方法，返回一个保存发送给它的所有东西的PrintWriter，并把结果存进一个可以稍后访问的字段中。</p><p>3）传递该包装器给doFilter。此调用是合法的，因为HttpServletResponseWrapper实现HttpServletResponse。</p><p>4）提取和修改输出。在调用FilterChain的doFilter方法后，原资源的输出只要利用步骤2中提供的机制就可以得到。只要对你的应用适合，就可以修改或替换它。</p><p>5）发送修改过的输出到客户机。因为原资源不再发送输出到客户机（这些输出已经存放到你的响应包装器中了），所以必须发送这些输出。这样，你的过滤器需要从原响应对象中获得PrintWriter或OutputStream，并传递修改过的输出到该流中。 (2).GZipFilter类 (3).GZipUtil类 (4).在web.xml中配置 GZipFilter</p></div></td></tr></tbody></table><br/>
下附HttpServletRequestWrapper、HttpServletResponseWrapper用法 <br/></div><div><div style="background-color:rgb(231, 229, 220);font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;"><div style="background-color: rgb(248, 248, 248); color: silver; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: 9px;"><b>[java]</b> <a href="http://blog.csdn.net/it_man/article/details/7556903#" style="background-color: inherit; color: rgb(160, 160, 160);" title="view plain">view plain</a><a href="http://blog.csdn.net/it_man/article/details/7556903#" style="background-color: inherit; color: rgb(160, 160, 160);" title="copy">copy</a></div><ol start="1" style="background-color:rgb(255, 255, 255);color:rgb(92, 92, 92);"><li style="color: inherit;"><span style="background-color:inherit;color:black;"><span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">class</span><span style="background-color: inherit;"> FilteredRequest </span><span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">extends</span><span style="background-color: inherit;"> HttpServletRequestWrapper  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;">    {  </span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;">        <span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">public</span><span style="background-color: inherit;"> FilteredRequest(ServletRequest request)  </span></span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">        {  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;">            <span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">super</span><span style="background-color: inherit;">((HttpServletRequest) request);  </span></span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">        }  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;">  </span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">        <span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">public</span><span style="background-color: inherit;"> String getParameter(String paramName)  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;">        {  </span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">            String value = <span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">super</span><span style="background-color: inherit;">.getParameter(paramName);  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;">            <span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">if</span><span style="background-color: inherit;"> (</span><span style="background-color:inherit;color:blue;">&quot;myParameter&quot;</span><span style="background-color: inherit;">.equals(paramName))  </span></span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">            {  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;">                <span style="background-color:inherit;color:rgb(0, 130, 0);">// 更改请求参数的值</span><span style="background-color: inherit;">  </span></span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">                value += <span style="background-color:inherit;color:blue;">&quot;|127.0.0.1&quot;</span><span style="background-color: inherit;">;  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;">            }  </span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">            <span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">return</span><span style="background-color: inherit;"> value;  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;">        }  </span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;">        <span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">public</span><span style="background-color: inherit;"> String[] getParameterValues(String paramName)  </span></span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">        {  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;">            String values[] = <span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">super</span><span style="background-color: inherit;">.getParameterValues(paramName);  </span></span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">            <span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">return</span><span style="background-color: inherit;"> values;  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;">        }  </span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">    }  </span></li></ol></div><br/><div style="background-color:rgb(231, 229, 220);font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;"><div style="background-color: rgb(248, 248, 248); color: silver; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: 9px;"><b>[java]</b> <a href="http://blog.csdn.net/it_man/article/details/7556903#" style="background-color: inherit; color: rgb(160, 160, 160);" title="view plain">view plain</a><a href="http://blog.csdn.net/it_man/article/details/7556903#" style="background-color: inherit; color: rgb(160, 160, 160);" title="copy">copy</a></div><ol start="1" style="background-color:rgb(255, 255, 255);color:rgb(92, 92, 92);"><li style="color: inherit;"><span style="background-color:inherit;color:black;"><span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">import</span><span style="background-color: inherit;"> java.io.ByteArrayOutputStream;  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;"><span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">import</span><span style="background-color: inherit;"> java.io.IOException;  </span></span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;"><span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">import</span><span style="background-color: inherit;"> java.io.PrintWriter;  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;"><span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">import</span><span style="background-color: inherit;"> java.io.UnsupportedEncodingException;  </span></span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;"><span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">import</span><span style="background-color: inherit;"> javax.servlet.ServletResponse;  </span></span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;"><span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">import</span><span style="background-color: inherit;"> javax.servlet.http.HttpServletResponse;  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;"><span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">import</span><span style="background-color: inherit;"> javax.servlet.http.HttpServletResponseWrapper;  </span></span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;"><span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">public</span><span style="background-color: inherit;"> </span><span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">class</span><span style="background-color: inherit;"> WrapperResponse </span><span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">extends</span><span style="background-color: inherit;"> HttpServletResponseWrapper  </span></span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">{  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;">    <span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">private</span><span style="background-color: inherit;"> MyPrintWriter tmpWriter;  </span></span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;">    <span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">private</span><span style="background-color: inherit;"> ByteArrayOutputStream output;  </span></span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;">    <span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">public</span><span style="background-color: inherit;"> WrapperResponse(ServletResponse httpServletResponse)  </span></span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">    {  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;">        <span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">super</span><span style="background-color: inherit;">((HttpServletResponse)httpServletResponse);  </span></span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">        output = <span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">new</span><span style="background-color: inherit;"> ByteArrayOutputStream();  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;">        tmpWriter = <span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">new</span><span style="background-color: inherit;"> MyPrintWriter(output);  </span></span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">    }  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;">  </span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">    <span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">public</span><span style="background-color: inherit;"> </span><span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">void</span><span style="background-color: inherit;"> finalize() </span><span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">throws</span><span style="background-color: inherit;"> Throwable  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;">    {  </span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">        <span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">super</span><span style="background-color: inherit;">.finalize();  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;">        output.close();  </span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">        tmpWriter.close();  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;">    }  </span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;">    <span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">public</span><span style="background-color: inherit;"> String getContent()  </span></span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">    {  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;">        <span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">try</span><span style="background-color: inherit;">  </span></span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">        {  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;">            tmpWriter.flush(); <span style="background-color:inherit;color:rgb(0, 130, 0);">//刷新该流的缓冲，详看java.io.Writer.flush()   </span><span style="background-color: inherit;">  </span></span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">            String s = tmpWriter.getByteArrayOutputStream().toString(<span style="background-color:inherit;color:blue;">&quot;UTF-8&quot;</span><span style="background-color: inherit;">);  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;">            <span style="background-color:inherit;color:rgb(0, 130, 0);">//此处可根据需要进行对输出流以及Writer的重置操作   </span><span style="background-color: inherit;">  </span></span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">            <span style="background-color:inherit;color:rgb(0, 130, 0);">//比如tmpWriter.getByteArrayOutputStream().reset()   </span><span style="background-color: inherit;">  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;">            <span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">return</span><span style="background-color: inherit;"> s;  </span></span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">        } <span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">catch</span><span style="background-color: inherit;"> (UnsupportedEncodingException e)  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;">        {  </span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">            <span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">return</span><span style="background-color: inherit;"> </span><span style="background-color:inherit;color:blue;">&quot;UnsupportedEncoding&quot;</span><span style="background-color: inherit;">;  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;">        }  </span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">    }  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;">  </span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">    <span style="background-color:inherit;color:rgb(0, 130, 0);">//覆盖getWriter()方法，使用我们自己定义的Writer   </span><span style="background-color: inherit;">  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;">    <span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">public</span><span style="background-color: inherit;"> PrintWriter getWriter() </span><span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">throws</span><span style="background-color: inherit;"> IOException  </span></span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">    {  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;">        <span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">return</span><span style="background-color: inherit;"> tmpWriter;  </span></span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">    }  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;">  </span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">    <span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">public</span><span style="background-color: inherit;"> </span><span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">void</span><span style="background-color: inherit;"> close() </span><span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">throws</span><span style="background-color: inherit;"> IOException  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;">    {  </span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">        tmpWriter.close();  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;">    }  </span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;">    <span style="background-color:inherit;color:rgb(0, 130, 0);">//自定义PrintWriter，为的是把response流写到自己指定的输入流当中   </span><span style="background-color: inherit;">  </span></span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">    <span style="background-color:inherit;color:rgb(0, 130, 0);">//而非默认的ServletOutputStream   </span><span style="background-color: inherit;">  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;">    <span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">private</span><span style="background-color: inherit;"> </span><span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">static</span><span style="background-color: inherit;"> </span><span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">class</span><span style="background-color: inherit;"> MyPrintWriter </span><span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">extends</span><span style="background-color: inherit;"> PrintWriter  </span></span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">    {  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;">        ByteArrayOutputStream myOutput; <span style="background-color:inherit;color:rgb(0, 130, 0);">//此即为存放response输入流的对象   </span><span style="background-color: inherit;">  </span></span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;">        <span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">public</span><span style="background-color: inherit;"> MyPrintWriter(ByteArrayOutputStream output)  </span></span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">        {  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;">            <span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">super</span><span style="background-color: inherit;">(output);  </span></span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">            myOutput = output;  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;">        }  </span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;">        <span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">public</span><span style="background-color: inherit;"> ByteArrayOutputStream getByteArrayOutputStream()  </span></span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">        {  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;">            <span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">return</span><span style="background-color: inherit;"> myOutput;  </span></span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">        }  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;">    }  </span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">}  </span></li></ol></div><br/><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;">调用处 </span><br/></div><div><div style="background-color:rgb(231, 229, 220);font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;"><div style="background-color: rgb(248, 248, 248); color: silver; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: 9px;"><b>[java]</b> <a href="http://blog.csdn.net/it_man/article/details/7556903#" style="background-color: inherit; color: rgb(160, 160, 160);" title="view plain">view plain</a><a href="http://blog.csdn.net/it_man/article/details/7556903#" style="background-color: inherit; color: rgb(160, 160, 160);" title="copy">copy</a></div><ol start="1" style="background-color:rgb(255, 255, 255);color:rgb(92, 92, 92);"><li style="color: inherit;"><span style="background-color:inherit;color:black;"><span style="background-color: inherit;">FilteredRequest filterRequest = </span><span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">new</span><span style="background-color: inherit;"> FilteredRequest(request);  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;">WrapperResponse filterResponse = <span style="background-color:inherit;color:rgb(0, 102, 153);font-weight:bold;">new</span><span style="background-color: inherit;"> WrapperResponse(response);  </span></span></li><li style="color: inherit;"><span style="background-color:inherit;color:black;">filterChain.doFilter(filterRequest, filterResponse);  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="background-color:inherit;color:black;">String content = filterResponse.getContent();  </span></li></ol></div><br/><br/></div><div><span style="font-family: Helvetica, Tahoma, Arial, sans-serif;"><span style="font-family: 宋体, Verdana, Arial, Helvetica, sans-serif;"><strong><span style="font-family:Helvetica, Tahoma, Arial, sans-serif;">或者自己实现</span>HttpServletResponse和<span style="font-family:Helvetica, Tahoma, Arial, sans-serif;">HttpServletRequest接口，但这是麻烦的。</span></strong></span><br/></span></div><div>如果要管理session，或session实现共享就用HttpSessionWrapper<br/></div><div><h2 style="color:rgb(9, 67, 130);font-family:微软雅黑, 黑体;font-size:18px;font-weight:300;"><a href="http://blog.sina.com.cn/s/blog_866b16a60100z2bi.html" style="color:rgb(51, 102, 153);">学习oscache页面缓存得到的启示</a></h2><a href="http://blog.sina.com.cn/s/blog_866b16a60100z2bi.html" style="color:rgb(51, 102, 153);"> :http://blog.sina.com.cn/s/blog_866b16a60100z2bi.html</a><br/></div><div><span style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;">首先说一个无关的，但高手必须了解的。 servlet的Response的输出流在URL中保存Session ID的方法是哪一个？</span><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;">A. the encodeURL method of the HttpServletRequest interface</div><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;"><span style="color:rgb(255, 98, 7);">B. the encodeURL method of the HttpServletResponse interface</span></div><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;">C. the rewriteURL method of the HttpServletRequest interface</div><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;">D. the rewriteURL method of the HttpServletResponse interface</div><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;"><br/></div><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;">答案选B.</div><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;"><br/></div><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;">学习完黎老师讲的oscache页面缓存后，它的实现原理大致如下（原理和oscache一样，但oscache做的更好，我这里只是用伪代码简单描述）：</div><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;">Cachefilter <span style="font-family:Monaco, 'DejaVu sans Mono', 'Bitstream Vera sans Mono', Consolas, 'Courier new', monospace;font-size:12px;"><strong>implements</strong><span style="color:black;"> </span></span> filter{</div><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;">dofilter(request, response, chain){</div><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;">String urlpath = req,...;</div><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;">if(Oscache.contains(urlpath)){</div><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;">String content = oscache.getKey(urlpath);</div><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;"><span style="color:rgb(255, 0, 0);">response.write(content);</span></div><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;">}else{</div><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;"><span style="color:rgb(255, 0, 0);">CacheHettpServletResponseWrapper wrapper = new CacheHettpServletResponseWrapper (respone);</span></div><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;"><span style="color:rgb(12, 37, 254);">chain.doFilter(reques, wrapper);</span></div><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;"><span style="color:rgb(30, 255, 5);">String content = wrapper.getContent();//</span>获取服务端往客户端输出的html代码</div><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;">Oscache.put(urlpath, content);</div><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;"><span style="color:rgb(146, 110, 36);">response.write(content);</span></div><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;">}</div><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;">}</div><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;">}<br/><div><br/></div></div><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;">public CacheHettpServletResponseWrapper extends  HettpServletResponseWrapper{</div><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;">private String content;</div><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;"><span style="color:rgb(0, 0, 0);">public </span>CacheHettpServletResponseWrapper(HttpServletResponse response){</div><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;">.......</div><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;">}</div><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;">//重写HettpServletResponseWrapper的一个方法，这里可能不是write方法，忘记叫什么了，自己去看。后来看了下是</div><ol start="1" style="color: rgb(92, 92, 92); font-family: simsun;"><li style="color:inherit;"><span style="color:rgb(51, 51, 51);font-family:Consolas, 'Courier new', Courier, mono, serif;font-size:12px;"><span style="background-color:inherit;color:black;"><span style="background-color:inherit;">/覆盖getWriter()方法，使用我们自己定义的Writer   </span><span style="background-color:inherit;">  </span></span></span></li><li style="background-color:rgb(248, 248, 248);"><span style="background-color:inherit;color:black;">    <span style="background-color:inherit;"><strong>public</strong></span><span style="background-color:inherit;"> PrintWriter getWriter() </span><span style="background-color:inherit;"><strong>throws</strong></span><span style="background-color:inherit;"> IOException  </span></span></li><li style="background-color:rgb(248, 248, 248);"><span style="background-color:inherit;color:black;"><span style="background-color:inherit;"><br/></span></span></li></ol><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;">HettpServletResponseWrapper吧</div><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;">public void <span style="font-family:Consolas, 'Courier new', Courier, mono, serif;font-size:12px;">getWriter</span>(String Content){</div><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;">this.Content = content;</div><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;">}</div><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;">public String getContent(){</div><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;">return this.content;</div><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;">}</div><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;">}</div><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;"><br/></div><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;">:利用继承HettpServletResponseWrapper可以控制往客户端的输出，或在往客户端输出前取得要输出的内容。</div><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;">同样希望大家会<span style="font-family:Helvetica, Tahoma, Arial, sans-serif;">HttpServletRequestWrapper。 或者自己实现</span>HttpServletResponse和<span style="font-family:Helvetica, Tahoma, Arial, sans-serif;">HttpServletRequest接口，但这是麻烦的。</span></div><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;"><table><tbody><tr><td style="font-family:Arial;"><div style="color: rgb(51, 51, 51);"><p>1）建立一个响应包装器。扩展javax.servlet.http.HttpServletResponseWrapper。</p><p>2）提供一个缓存输出的PrintWriter。重载getWriter方法，返回一个保存发送给它的所有东西的PrintWriter，并把结果存进一个可以稍后访问的字段中。</p><p>3）传递该包装器给doFilter。此调用是合法的，因为HttpServletResponseWrapper实现HttpServletResponse。</p><p>4）提取和修改输出。在调用FilterChain的doFilter方法后，原资源的输出只要利用步骤2中提供的机制就可以得到。只要对你的应用适合，就可以修改或替换它。</p><p>5）发送修改过的输出到客户机。因为原资源不再发送输出到客户机（这些输出已经存放到你的响应包装器中了），所以必须发送这些输出。这样，你的过滤器需要从原响应对象中获得PrintWriter或OutputStream，并传递修改过的输出到该流中。 (2).GZipFilter类 (3).GZipUtil类 (4).在web.xml中配置 GZipFilter</p></div></td></tr></tbody></table></div><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;">--------------------------------------------------</div><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;">页面缓存</div><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;">---》html---&gt;client</div><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;">二级缓存</div><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;">--》action--&gt;service层--&gt;<span style="color:rgb(253, 90, 21);">Jsp-</span>-&gt;html--&gt;client</div><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;"><br/></div><div style="background-color: rgb(113, 192, 231); color: rgb(70, 70, 70); font-family: simsun;">：从上看出为什么页面缓存要比二级缓存要快。因为二级缓存处理流程更多，并且还要解析jsp及标签等转化成html，这是耗时的。</div></div></div><br/></div></div></span>
</div></body></html> 