<html>
<head>
  <title>Spring 使用注解方式进行事务管理.html</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/306387 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="698"/>
<h1>Spring 使用注解方式进行事务管理.html</h1>

<div>
<span><p style="font-size: 13px; line-height: 19.5px; margin: 10px auto; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; widows: 1; background-color: rgb(255, 255, 255);"><span style="line-height: 1.5; font-size: 18px;"><strong>使用步骤：</strong></span></p><p style="font-size: 13px; line-height: 19.5px; margin: 10px auto; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; widows: 1; background-color: rgb(255, 255, 255);"><span style="line-height: 1.5; font-size: 14px;"><strong>步骤一、在spring配置文件中引入&lt;tx:&gt;命名空间</strong></span><br/>
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;<br/>
 xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br/>
 <span style="line-height: 1.5; color: rgb(62, 17, 253);"><strong>xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot;</strong></span><br/>
 xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans<br/>
 http://www.springframework.org/schema/beans/spring-beans-2.0.xsd<span style="line-height: 1.5; color: rgb(7, 10, 254);"><strong><br/>
 http://www.springframework.org/schema/tx<br/>
 http://www.springframework.org/schema/tx/spring-tx-2.0.xsd&quot;&gt;<br/></strong><span style="line-height: 1.5; color: rgb(0, 0, 0);"><strong><span style="line-height: 1.5; color: rgb(251, 23, 7);"><br/><span style="line-height: 1.5; color: rgb(0, 0, 0);">步骤二、具有@Transactional 注解的bean自动配置为声明式事务支持</span></span></strong> <br/></span></span></p><div style="border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; widows: 1; background-color: rgb(245, 245, 245); font-family: 'Courier New' !important; font-size: 12px !important;"><div style="margin-top: 5px;"><span style="padding-right: 5px; line-height: 1.5 !important; font-size: 12px !important;"><a style="color: navy; text-decoration: none; border: none !important;" title="复制代码"><img src="Spring 使用注解方式进行事务管理.html_files/Image.gif" type="image/gif" data-filename="Image.gif" alt="复制代码" style="border-style: none !important;"/></a></span></div><pre style="margin-top: 0px; margin-bottom: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: 'Courier New' !important; font-size: 12px !important;"><span style="color: rgb(0, 128, 0); line-height: 1.5 !important; font-size: 12px !important;">&lt;!--</span><span style="color: rgb(0, 128, 0); line-height: 1.5 !important; font-size: 12px !important;"> 事务管理器配置, Hibernate单数据源事务 </span><span style="color: rgb(0, 128, 0); line-height: 1.5 !important; font-size: 12px !important;">--&gt;</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important; font-size: 12px !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important; font-size: 12px !important;">bean </span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important; font-size: 12px !important;">id</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important; font-size: 12px !important;">=&quot;defaultTransactionManager&quot;</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important; font-size: 12px !important;"> class</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important; font-size: 12px !important;">=&quot;org.springframework.orm.hibernate3.HibernateTransactionManager&quot;</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important; font-size: 12px !important;">&gt;</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important; font-size: 12px !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important; font-size: 12px !important;">property </span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important; font-size: 12px !important;">name</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important; font-size: 12px !important;">=&quot;sessionFactory&quot;</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important; font-size: 12px !important;"> ref</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important; font-size: 12px !important;">=&quot;sessionFactory&quot;</span> <span style="color: rgb(0, 0, 255); line-height: 1.5 !important; font-size: 12px !important;">/&gt;</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important; font-size: 12px !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important; font-size: 12px !important;">bean</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important; font-size: 12px !important;">&gt;</span><span style="color: rgb(0, 128, 0); line-height: 1.5 !important; font-size: 12px !important;">&lt;!--</span><span style="color: rgb(0, 128, 0); line-height: 1.5 !important; font-size: 12px !important;"> 使用annotation定义事务 </span><span style="color: rgb(0, 128, 0); line-height: 1.5 !important; font-size: 12px !important;">--&gt;</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important; font-size: 12px !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important; font-size: 12px !important;">tx:annotation-driven </span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important; font-size: 12px !important;">transaction-manager</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important; font-size: 12px !important;">=&quot;defaultTransactionManager&quot;</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important; font-size: 12px !important;"> proxy-target-class</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important; font-size: 12px !important;">=&quot;true&quot;</span> <span style="color: rgb(0, 0, 255); line-height: 1.5 !important; font-size: 12px !important;">/&gt;</span></pre><div style="margin-top: 5px;"><span style="padding-right: 5px; line-height: 1.5 !important; font-size: 12px !important;"><a style="color: navy; text-decoration: none; border: none !important;" title="复制代码"><img src="Spring 使用注解方式进行事务管理.html_files/Image [1].gif" type="image/gif" data-filename="Image.gif" alt="复制代码" style="border-style: none !important;"/></a></span></div></div><p style="font-size: 13px; line-height: 19.5px; margin: 10px auto; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; widows: 1; background-color: rgb(255, 255, 255);"> </p><p style="font-size: 13px; line-height: 19.5px; margin: 10px auto; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; widows: 1; background-color: rgb(255, 255, 255);"><span style="line-height: 1.5; color: rgb(7, 10, 254);"><span style="line-height: 1.5; color: rgb(0, 0, 0);"><strong>步骤三、在接口或类的声明处 ,写一个@Transactional.</strong><br/>
要是只在接口上写, 接口的实现类就会继承下来、接口的实现类的具体方法,可以覆盖类声明处的设置<br/>
@Transactional   //类级的注解、适用于类中所有的public的方法</span></span></p><p style="font-size: 13px; line-height: 19.5px; margin: 10px auto; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; widows: 1; background-color: rgb(255, 255, 255);"><strong><span style="line-height: 1.5; color: rgb(7, 10, 254); font-size: 18px;"><span style="line-height: 1.5; color: rgb(0, 0, 0);">事务的传播行为和隔离级别</span></span></strong></p><p style="font-size: 13px; line-height: 19.5px; margin: 10px auto; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; widows: 1; background-color: rgb(255, 255, 255);"><span style="line-height: 1.5; font-size: medium;">大家在使用spring的注解式事务管理时，对事务的传播行为和隔离级别可能有点不知所措，下边就详细的介绍下以备方便查阅。</span></p><p style="font-size: 13px; line-height: 19.5px; margin: 10px auto; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; widows: 1; background-color: rgb(255, 255, 255);"><span style="line-height: 1.5; font-size: medium;"><span style="line-height: 1.5; font-family: 黑体;"><strong>事物注解方式: @Transactional</strong></span></span></p><p style="font-size: 13px; line-height: 19.5px; margin: 10px auto; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; widows: 1; background-color: rgb(255, 255, 255);"><span style="line-height: 1.5; font-size: medium;"><span style="line-height: 1.5; font-family: 黑体;">当标于类前时, 标示类中所有方法都进行事物处理</span></span> , <span style="line-height: 1.5; font-size: medium;"><span style="line-height: 1.5; font-family: 黑体; color: rgb(103, 78, 167);">例子:</span></span></p><div style="border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; widows: 1; background-color: rgb(245, 245, 245); font-family: 'Courier New' !important; font-size: 12px !important;"><pre style="margin-top: 0px; margin-bottom: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: 'Courier New' !important; font-size: 12px !important;"><span style="line-height: 1.5 !important; font-size: 12px !important;">@Transactional
</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important; font-size: 12px !important;">public</span> <span style="color: rgb(0, 0, 255); line-height: 1.5 !important; font-size: 12px !important;">class</span> TestServiceBean <span style="color: rgb(0, 0, 255); line-height: 1.5 !important; font-size: 12px !important;">implements</span> TestService {} 
</pre></div><p style="font-size: 13px; line-height: 19.5px; margin: 10px auto; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; widows: 1; background-color: rgb(255, 255, 255);"><span style="line-height: 1.5; font-size: medium;"><span style="line-height: 1.5; font-family: 黑体;"><strong>当类中某些方法不需要事物时:</strong></span></span></p><div style="border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; widows: 1; background-color: rgb(245, 245, 245); font-family: 'Courier New' !important; font-size: 12px !important;"><div style="margin-top: 5px;"><span style="padding-right: 5px; line-height: 1.5 !important; font-size: 12px !important;"><a style="color: navy; text-decoration: none; border: none !important;" title="复制代码"><img src="Spring 使用注解方式进行事务管理.html_files/Image [2].gif" type="image/gif" data-filename="Image.gif" alt="复制代码" style="border-style: none !important;"/></a></span></div><pre style="margin-top: 0px; margin-bottom: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: 'Courier New' !important; font-size: 12px !important;"><span style="line-height: 1.5 !important; font-size: 12px !important;">@Transactional
</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important; font-size: 12px !important;">public</span> <span style="color: rgb(0, 0, 255); line-height: 1.5 !important; font-size: 12px !important;">class</span> TestServiceBean <span style="color: rgb(0, 0, 255); line-height: 1.5 !important; font-size: 12px !important;">implements</span><span style="line-height: 1.5 !important; font-size: 12px !important;"> TestService {   
    </span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important; font-size: 12px !important;">private</span><span style="line-height: 1.5 !important; font-size: 12px !important;"> TestDao dao;   
    </span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important; font-size: 12px !important;">public</span> <span style="color: rgb(0, 0, 255); line-height: 1.5 !important; font-size: 12px !important;">void</span><span style="line-height: 1.5 !important; font-size: 12px !important;"> setDao(TestDao dao) {
        </span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important; font-size: 12px !important;">this</span>.dao =<span style="line-height: 1.5 !important; font-size: 12px !important;"> dao;
    }   
    @Transactional(propagation </span>=<span style="line-height: 1.5 !important; font-size: 12px !important;"> Propagation.NOT_SUPPORTED)
    </span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important; font-size: 12px !important;">public</span> List&lt;Object&gt;<span style="line-height: 1.5 !important; font-size: 12px !important;"> getAll() {
        </span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important; font-size: 12px !important;">return</span> <span style="color: rgb(0, 0, 255); line-height: 1.5 !important; font-size: 12px !important;">null</span><span style="line-height: 1.5 !important; font-size: 12px !important;">;
    }   
}</span></pre><div style="margin-top: 5px;"><span style="padding-right: 5px; line-height: 1.5 !important; font-size: 12px !important;"><a style="color: navy; text-decoration: none; border: none !important;" title="复制代码"><img src="Spring 使用注解方式进行事务管理.html_files/Image [3].gif" type="image/gif" data-filename="Image.gif" alt="复制代码" style="border-style: none !important;"/></a></span></div></div><p style="font-size: 13px; line-height: 19.5px; margin: 10px auto; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; widows: 1; background-color: rgb(255, 255, 255);"><span style="line-height: 1.5; font-size: medium;"><span style="line-height: 1.5; font-family: 黑体;"><strong>事物传播行为介绍:</strong> <br/></span><span style="line-height: 1.5; font-family: 黑体;">@Transactional(propagation=Propagation.REQUIRED) <br/>
如果有事务, 那么加入事务, 没有的话新建一个(默认情况下)<br/>
@Transactional(propagation=Propagation.NOT_SUPPORTED) <br/>
容器不为这个方法开启事务<br/>
@Transactional(propagation=Propagation.REQUIRES_NEW) <br/>
不管是否存在事务,都创建一个新的事务,原来的挂起,新的执行完毕,继续执行老的事务<br/>
@Transactional(propagation=Propagation.MANDATORY) <br/>
必须在一个已有的事务中执行,否则抛出异常<br/>
@Transactional(propagation=Propagation.NEVER) <br/>
必须在一个没有的事务中执行,否则抛出异常(与Propagation.MANDATORY相反)<br/>
@Transactional(propagation=Propagation.SUPPORTS) <br/>
如果其他bean调用这个方法,在其他bean中声明事务,那就用事务.如果其他bean没有声明事务,那就不用事务.</span></span></p><p style="font-size: 13px; line-height: 19.5px; margin: 10px auto; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; widows: 1; background-color: rgb(255, 255, 255);"><span style="line-height: 1.5; font-size: medium;"><span style="line-height: 1.5; font-family: 黑体;"><strong>事物超时设置:<br/></strong>@Transactional(timeout=30) //默认是30秒</span></span></p><p style="font-size: 13px; line-height: 19.5px; margin: 10px auto; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; widows: 1; background-color: rgb(255, 255, 255);"><span style="line-height: 1.5; font-size: medium;"><span style="line-height: 1.5; font-family: 黑体;"><strong>事务隔离级别:<br/></strong>@Transactional(isolation = Isolation.READ_UNCOMMITTED)<br/>
读取未提交数据(会出现脏读, 不可重复读) 基本不使用<br/>
@Transactional(isolation = Isolation.READ_COMMITTED)<br/>
读取已提交数据(会出现不可重复读和幻读)<br/>
@Transactional(isolation = Isolation.REPEATABLE_READ)<br/>
可重复读(会出现幻读)<br/>
@Transactional(isolation = Isolation.SERIALIZABLE)<br/>
串行化</span></span></p><p style="font-size: 13px; line-height: 19.5px; margin: 10px auto; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; widows: 1; background-color: rgb(255, 255, 255);"><span style="line-height: 1.5; font-size: medium;"><span style="line-height: 1.5; font-family: 黑体; color: rgb(255, 0, 255);">MYSQL: 默认为REPEATABLE_READ级别<br/>
SQLSERVER: 默认为READ_COMMITTED</span></span></p><p style="font-size: 13px; line-height: 26px; margin: 10px auto; widows: 1; color: rgb(51, 51, 51); font-family: Arial; background-color: rgb(255, 255, 255);"><span style="line-height: 1.5; font-size: medium;"><span style="line-height: 1.5; font-family: 黑体; color: rgb(0, 0, 0);"><strong>脏读</strong> : 一个事务读取到另一事务未提交的更新数据<br/><strong>不可重复读</strong> : 在同一事务中, 多次读取同一数据返回的结果有所不同, 换句话说, <br/>
后续读取可以读到另一事务已提交的更新数据. 相反, &quot;可重复读&quot;在同一事务中多次<br/>
读取数据时, 能够保证所读数据一样, 也就是后续读取不能读到另一事务已提交的更新数据<br/><strong>幻读</strong> : 一个事务读到另一个事务已提交的insert数据</span></span></p><p style="font-size: 13px; line-height: 26px; margin: 10px auto; widows: 1; color: rgb(51, 51, 51); font-family: Arial; background-color: rgb(255, 255, 255);"><span style="line-height: 1.5; font-size: 18px;"><strong><span style="line-height: 1.5; font-family: 黑体; color: rgb(0, 0, 0);">@Transactional注解中常用参数说明</span></strong></span></p><table border="1" cellpadding="0" cellspacing="0" style="border-color: silver; word-break: break-word; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; widows: 1; width: 1659px; background-color: rgb(255, 255, 255);"><tbody><tr><td style="font-size: 12px; border-color: silver; padding: 3px;" width="21%"><p style="font-size: 13px; line-height: 1.5; margin: 10px auto;"><span style="line-height: 1.5; font-size: 14px;">参 数 名 称</span></p></td><td style="font-size: 12px; border-color: silver; padding: 3px;" width="78%"><p style="font-size: 13px; line-height: 1.5; margin: 10px auto;"><span style="line-height: 1.5; font-size: 14px;">功 能 描 述</span></p></td></tr><tr><td style="font-size: 12px; border-color: silver; padding: 3px;" width="21%"><p style="font-size: 13px; line-height: 1.5; margin: 10px auto;"><span style="line-height: 1.5; font-size: 14px;">readOnly</span></p></td><td style="font-size: 12px; border-color: silver; padding: 3px;" valign="top" width="78%"><p style="font-size: 13px; line-height: 1.5; margin: 10px auto;"><span style="line-height: 1.5; font-size: 14px;">该属性用于设置当前事务是否为只读事务，设置为true表示只读，false则表示可读写，默认值为false。例如：@Transactional(readOnly=true)</span></p></td></tr><tr><td style="font-size: 12px; border-color: silver; padding: 3px;" width="21%"><p style="font-size: 13px; line-height: 1.5; margin: 10px auto;"><span style="line-height: 1.5; font-size: 14px;">rollbackFor</span></p></td><td style="font-size: 12px; border-color: silver; padding: 3px;" valign="top" width="78%"><p style="font-size: 13px; line-height: 1.5; margin: 10px auto;"><span style="line-height: 1.5; font-size: 14px;">该属性用于设置需要进行回滚的异常类数组，当方法中抛出指定异常数组中的异常时，则进行事务回滚。例如：</span></p><p style="font-size: 13px; line-height: 1.5; margin: 10px auto;"><span style="line-height: 1.5; font-size: 14px;">指定单一异常类：@Transactional(rollbackFor=RuntimeException.class)</span></p><p style="font-size: 13px; line-height: 1.5; margin: 10px auto;"><span style="line-height: 1.5; font-size: 14px;">指定多个异常类：@Transactional(rollbackFor={RuntimeException.class, Exception.class})</span></p></td></tr></tbody></table><p style="font-size: 13px; line-height: 26px; margin: 10px auto; widows: 1; color: rgb(51, 51, 51); font-family: Arial; background-color: rgb(255, 255, 255);"> 续表）</p><table border="1" cellpadding="0" cellspacing="0" style="border-color: silver; word-break: break-word; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; widows: 1; width: 1659px; background-color: rgb(255, 255, 255);"><tbody><tr><td style="font-size: 12px; border-color: silver; padding: 3px;" width="21%"><p style="font-size: 13px; line-height: 1.5; margin: 10px auto;"><span style="line-height: 1.5; font-size: 14px;">参 数 名 称</span></p></td><td style="font-size: 12px; border-color: silver; padding: 3px;" width="78%"><p style="font-size: 13px; line-height: 1.5; margin: 10px auto;"><span style="line-height: 1.5; font-size: 14px;">功 能 描 述</span></p></td></tr><tr><td style="font-size: 12px; border-color: silver; padding: 3px;" width="21%"><p style="font-size: 13px; line-height: 1.5; margin: 10px auto;"><span style="line-height: 1.5; font-size: 14px;">rollbackForClassName</span></p></td><td style="font-size: 12px; border-color: silver; padding: 3px;" valign="top" width="78%"><p style="font-size: 13px; line-height: 1.5; margin: 10px auto;"><span style="line-height: 1.5; font-size: 14px;">该属性用于设置需要进行回滚的异常类名称数组，当方法中抛出指定异常名称数组中的异常时，则进行事务回滚。例如：</span></p><p style="font-size: 13px; line-height: 1.5; margin: 10px auto;"><span style="line-height: 1.5; font-size: 14px;">指定单一异常类名称：@Transactional(rollbackForClassName=&quot;RuntimeException&quot;)</span></p><p style="font-size: 13px; line-height: 1.5; margin: 10px auto;"><span style="line-height: 1.5; font-size: 14px;">指定多个异常类名称：@Transactional(rollbackForClassName={&quot;RuntimeException&quot;,&quot;Exception&quot;})</span></p></td></tr><tr><td style="font-size: 12px; border-color: silver; padding: 3px;" width="21%"><p style="font-size: 13px; line-height: 1.5; margin: 10px auto;"><span style="line-height: 1.5; font-size: 14px;">noRollbackFor</span></p></td><td style="font-size: 12px; border-color: silver; padding: 3px;" valign="top" width="78%"><p style="font-size: 13px; line-height: 1.5; margin: 10px auto;"><span style="line-height: 1.5; font-size: 14px;">该属性用于设置不需要进行回滚的异常类数组，当方法中抛出指定异常数组中的异常时，不进行事务回滚。例如：</span></p><p style="font-size: 13px; line-height: 1.5; margin: 10px auto;"><span style="line-height: 1.5; font-size: 14px;">指定单一异常类：@Transactional(noRollbackFor=RuntimeException.class)</span></p><p style="font-size: 13px; line-height: 1.5; margin: 10px auto;"><span style="line-height: 1.5; font-size: 14px;">指定多个异常类：@Transactional(noRollbackFor={RuntimeException.class, Exception.class})</span></p></td></tr><tr><td style="font-size: 12px; border-color: silver; padding: 3px;" width="21%"><p style="font-size: 13px; line-height: 1.5; margin: 10px auto;"><span style="line-height: 1.5; font-size: 14px;">noRollbackForClassName</span></p></td><td style="font-size: 12px; border-color: silver; padding: 3px;" valign="top" width="78%"><p style="font-size: 13px; line-height: 1.5; margin: 10px auto;"><span style="line-height: 1.5; font-size: 14px;">该属性用于设置不需要进行回滚的异常类名称数组，当方法中抛出指定异常名称数组中的异常时，不进行事务回滚。例如：</span></p><p style="font-size: 13px; line-height: 1.5; margin: 10px auto;"><span style="line-height: 1.5; font-size: 14px;">指定单一异常类名称：@Transactional(noRollbackForClassName=&quot;RuntimeException&quot;)</span></p><p style="font-size: 13px; line-height: 1.5; margin: 10px auto;"><span style="line-height: 1.5; font-size: 14px;">指定多个异常类名称：</span></p><p style="font-size: 13px; line-height: 1.5; margin: 10px auto;"><span style="line-height: 1.5; font-size: 14px;">@Transactional(noRollbackForClassName={&quot;RuntimeException&quot;,&quot;Exception&quot;})</span></p></td></tr><tr><td style="font-size: 12px; border-color: silver; padding: 3px;" width="21%"><p style="font-size: 13px; line-height: 1.5; margin: 10px auto;"><span style="line-height: 1.5; font-size: 14px;">propagation</span></p></td><td style="font-size: 12px; border-color: silver; padding: 3px;" valign="top" width="78%"><p style="font-size: 13px; line-height: 1.5; margin: 10px auto;"><span style="line-height: 1.5; font-size: 14px;">该属性用于设置事务的传播行为，具体取值可参考表6-7。</span></p><p style="font-size: 13px; line-height: 1.5; margin: 10px auto;"><span style="line-height: 1.5; font-size: 14px;">例如：@Transactional(propagation=Propagation.NOT_SUPPORTED,readOnly=true)</span></p></td></tr><tr><td style="font-size: 12px; border-color: silver; padding: 3px;" width="21%"><p style="font-size: 13px; line-height: 1.5; margin: 10px auto;"><span style="line-height: 1.5; font-size: 14px;">isolation</span></p></td><td style="font-size: 12px; border-color: silver; padding: 3px;" valign="top" width="78%"><p style="font-size: 13px; line-height: 1.5; margin: 10px auto;"><span style="line-height: 1.5; font-size: 14px;">该属性用于设置底层数据库的事务隔离级别，事务隔离级别用于处理多事务并发的情况，通常使用数据库的默认隔离级别即可，基本不需要进行设置</span></p></td></tr><tr><td style="font-size: 12px; border-color: silver; padding: 3px;" width="21%"><p style="font-size: 13px; line-height: 1.5; margin: 10px auto;"><span style="line-height: 1.5; font-size: 14px;">timeout</span></p></td><td style="font-size: 12px; border-color: silver; padding: 3px;" valign="top" width="78%"><p style="font-size: 13px; line-height: 1.5; margin: 10px auto;"><span style="line-height: 1.5; font-size: 14px;">该属性用于设置事务的超时秒数，默认值为-1表示永不超时</span></p></td></tr></tbody></table><p style="font-size: 13px; line-height: 19.5px; margin: 10px auto; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; widows: 1; background-color: rgb(255, 255, 255);"><strong>注意的几点:</strong><br/>
1 @Transactional 只能被应用到public方法上, 对于其它非public的方法,如果标记了@Transactional也不会报错,但方法没有事务功能.<br/><br/>
2用 spring 事务管理器,由spring来负责数据库的打开,提交,回滚.默认遇到运行期例外(throw new RuntimeException(&quot;注释&quot;);)会回滚，即遇到不受检查（unchecked）的例外时回滚；而遇到需要捕获的例外(throw new Exception(&quot;注释&quot;);)不会回滚,即遇到受检查的例外（就是非运行时抛出的异常，编译器会检查到的异常叫受检查例外或说受检查异常）时，需我们指定方式来让事务回滚 要想所有异常都回滚,要加上 @Transactional( rollbackFor={Exception.class,其它异常}) .如果让unchecked例外不回滚： @Transactional(notRollbackFor=RunTimeException.class)<br/>
如下:<br/>
@Transactional(rollbackFor=Exception.class) //指定回滚,遇到异常Exception时回滚<br/>
public void methodName() {<br/>
throw new Exception(&quot;注释&quot;);<br/><br/>
}<br/>
@Transactional(noRollbackFor=Exception.class)//指定不回滚,遇到运行期例外(throw new RuntimeException(&quot;注释&quot;);)会回滚<br/>
public ItimDaoImpl getItemDaoImpl() {<br/>
throw new RuntimeException(&quot;注释&quot;);<br/>
}</p><p style="font-size: 13px; line-height: 19.5px; margin: 10px auto; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; widows: 1; background-color: rgb(255, 255, 255);">3、@Transactional 注解应该只被应用到 public 可见度的方法上。 如果你在 protected、private 或者 package-visible 的方法上使用 @Transactional 注解，它也不会报错， 但是这个被注解的方法将不会展示已配置的事务设置。</p><p style="font-size: 13px; line-height: 19.5px; margin: 10px auto; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; widows: 1; background-color: rgb(255, 255, 255);"><br/>
4、@Transactional 注解可以被应用于接口定义和接口方法、类定义和类的 public 方法上。然而，请注意仅仅 @Transactional 注解的出现不足于开启事务行为，它仅仅 是一种元数据，能够被可以识别 @Transactional 注解和上述的配置适当的具有事务行为的beans所使用。上面的例子中，其实正是 &lt;tx:annotation-driven/&gt;元素的出现 开启 了事务行为。</p><p style="font-size: 13px; line-height: 19.5px; margin: 10px auto; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; widows: 1; background-color: rgb(255, 255, 255);"><br/>
5、Spring团队的建议是你在具体的类（或类的方法）上使用 @Transactional 注解，而不要使用在类所要实现的任何接口上。你当然可以在接口上使用 @Transactional 注解，但是这将只能当你设置了基于接口的代理时它才生效。因为注解是 不能继承 的，这就意味着如果你正在使用基于类的代理时，那么事务的设置将不能被基于类的代理所识别，而且对象也将不会被事务代理所包装（将被确认为严重的）。因 此，请接受Spring团队的建议并且在具体的类上使用 @Transactional 注解。</p><br/><div style="color:gray"><small>来源： &lt;<a href="http://www.cnblogs.com/younggun/archive/2013/07/16/3193800.html">http://www.cnblogs.com/younggun/archive/2013/07/16/3193800.html</a><small>&gt;</small></small></div><small><small> </small></small></span>
</div></body></html> 