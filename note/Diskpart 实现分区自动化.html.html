<html>
<head>
  <title>Diskpart 实现分区自动化.html</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/306387 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="898"/>
<h1>Diskpart 实现分区自动化.html</h1>

<div>
<span><h1 style="margin: 0px; padding: 0px; color: rgb(51, 51, 51); font-family: Arial; line-height: 26px; widows: 1; background-color: rgb(255, 255, 255);">Diskpart 实现分区自动化</h1><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; line-height: 26px; widows: 1; background-color: rgb(255, 255, 255);">给硬盘分区，应该是每次新装系统都要干的事情，但是如果让你批量安装100台服务器的时候呢？显然用图形界面一台台的分区是不现实的。于是找到了这样一个 命令行工具——DiskPart。<br/><br/>
引用Windows 2003的Help：<br/>
DiskPart.exe 是一种文本模式命令解释程序，它使您能够通过使用脚本或从命令提示符直接输入来管理对象（磁盘、分区或卷）。在磁盘、分区或卷上使用 DiskPart.exe 命令之前，必须首先列出然后选中要给予其焦点的对象。当某个对象具有焦点时，键入的任何 DiskPart.exe 命令都会作用到该对象。 <br/><br/>
DiskPart /? 发现：<br/>
DiskPart可以使用/s参数执行一个DiskPart脚本。<br/><br/>
于是<br/>
Diskpart脚本：diskpart.script</p><div style="color: rgb(51, 51, 51); font-family: Arial; line-height: 26px; widows: 1; padding: 4px 5px 4px 4px; font-size: 13px; overflow: auto; width: 693.828125px; border: 1px solid rgb(204, 204, 204); background-color: rgb(238, 238, 238);"><img src="Diskpart 实现分区自动化.html_files/Image.jpg" type="image/jpeg" data-filename="Image.jpg" align="top" style="border-style: none;"/><span style="color: rgb(0, 0, 0);">select disk</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">0</span><span style="color: rgb(0, 0, 0);"><br/><img src="Diskpart 实现分区自动化.html_files/Image [1].jpg" type="image/jpeg" data-filename="Image.jpg" align="top" style="border-style: none;"/>create partition primary size</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">10240</span><span style="color: rgb(0, 0, 0);"><br/><img src="Diskpart 实现分区自动化.html_files/Image [2].jpg" type="image/jpeg" data-filename="Image.jpg" align="top" style="border-style: none;"/>select partition </span><span style="color: rgb(0, 0, 0);">2</span><span style="color: rgb(0, 0, 0);"><br/><img src="Diskpart 实现分区自动化.html_files/Image [3].jpg" type="image/jpeg" data-filename="Image.jpg" align="top" style="border-style: none;"/>assign letter</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">E<br/><img src="Diskpart 实现分区自动化.html_files/Image [4].jpg" type="image/jpeg" data-filename="Image.jpg" align="top" style="border-style: none;"/>create partition primary size</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">56320</span><span style="color: rgb(0, 0, 0);"><br/><img src="Diskpart 实现分区自动化.html_files/Image [5].jpg" type="image/jpeg" data-filename="Image.jpg" align="top" style="border-style: none;"/>select partition </span><span style="color: rgb(0, 0, 0);">3</span><span style="color: rgb(0, 0, 0);"><br/><img src="Diskpart 实现分区自动化.html_files/Image [6].jpg" type="image/jpeg" data-filename="Image.jpg" align="top" style="border-style: none;"/>assign letter</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">F</span></div><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; line-height: 26px; widows: 1; background-color: rgb(255, 255, 255);"><br/>
通过一个cmd来进行调用：mkPartition.cmd</p><div style="color: rgb(51, 51, 51); font-family: Arial; line-height: 26px; widows: 1; padding: 4px 5px 4px 4px; font-size: 13px; overflow: auto; width: 693.828125px; border: 1px solid rgb(204, 204, 204); background-color: rgb(238, 238, 238);"><img src="Diskpart 实现分区自动化.html_files/Image [7].jpg" type="image/jpeg" data-filename="Image.jpg" align="top" style="border-style: none;"/><span style="color: rgb(0, 0, 0);">diskpart /s //Server/diskpart.script<br/><img src="Diskpart 实现分区自动化.html_files/Image [8].jpg" type="image/jpeg" data-filename="Image.jpg" align="top" style="border-style: none;"/>format /FS:NTFS /V:APPS /Q E:<br/><img src="Diskpart 实现分区自动化.html_files/Image [9].jpg" type="image/jpeg" data-filename="Image.jpg" align="top" style="border-style: none;"/>format /FS:NTFS /V:WEB /Q F:</span></div><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; line-height: 26px; widows: 1; background-color: rgb(255, 255, 255);"><br/>
这样，就可以快速的完成分区并格式化硬盘了，也可以加入ADS的sysprep执行中，在安装时一并分区。唯一的小缺憾是Format由于安全问题，无法 不经过确认就格式化。导致不能简单地通过psexec或者wmi来远程执行这段脚本了。 <br/></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; line-height: 26px; widows: 1; background-color: rgb(255, 255, 255);">使用 DiskPart，可创建脚本以自动执行与磁盘相关的任务，如创建卷或将磁盘转换为动态磁盘。如果是使用“无人参与安装”或 Sysprep（它们不支持创建除<a href="http://www.cn-dos.net/mediawiki/index.php?title=%E5%90%AF%E5%8A%A8%E5%8D%B7&amp;action=edit" style="color: rgb(51, 102, 153); text-decoration: none;" title="启动卷">启 动卷</a>以外的卷）部署 Windows，则创建执行这些任务的脚本非常有用。</p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; line-height: 26px; widows: 1; background-color: rgb(255, 255, 255);">要点</p><ul style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; line-height: 26px; widows: 1; background-color: rgb(255, 255, 255);"><li>当将 DiskPart 命令用作脚本的一部分时，建议您将所有 DiskPart 操作一起作为单个 DiskPart 脚本的一部分来完成。您可以运行连续的 DiskPart 脚本，但是您必须在每个脚本之间允许至少 15 秒的时间，以便在后续的脚本中再次运行 DiskPart 命令前，完成前一个执行的关闭。否则，后续的脚本可能失败。您可以通过将<strong>timeout /t 15</strong> 命令添加到 DiskPart 脚本附带的批处理文件中，从而添加连续 DiskPart 脚本间的暂停。</li></ul><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; line-height: 26px; widows: 1; background-color: rgb(255, 255, 255);">要启动 DiskPart 脚本，请在命令提示符下键入：</p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; line-height: 26px; widows: 1; background-color: rgb(255, 255, 255);"><strong>diskpart /s</strong> <em>ScriptName.txt</em></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; line-height: 26px; widows: 1; background-color: rgb(255, 255, 255);">其中，<em>ScriptName.txt</em> 是包含脚本的文本文件的名称。</p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; line-height: 26px; widows: 1; background-color: rgb(255, 255, 255);">要将 DiskPart 的脚本输出重新定向到某个文件，请键入：</p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; line-height: 26px; widows: 1; background-color: rgb(255, 255, 255);"><strong>diskpart /s</strong> <em>ScriptName.txt</em> &gt; <em>LogFile.txt</em></p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; line-height: 26px; widows: 1; background-color: rgb(255, 255, 255);">其中，<em>LogFile.txt</em> 是 DiskPart 向其中写入输出的文本文件的名称。</p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; line-height: 26px; widows: 1; background-color: rgb(255, 255, 255);">当 DiskPart 启动时，DiskPart 版本和计算机名称将显示在命令提示符下。默认情况下，如果 DiskPart 在尝试执行脚本任务时发生错误，则 DiskPart 停止处理脚本并显示错误代码（除非指定了 <strong>noerr</strong> 参数）。但是，DiskPart 在遇到语法错误时总是返回错误，而无论是否使用了 <strong>noerr</strong> 参数。<strong>noerr</strong> 参数可用来执行有用的任务。例如，可使用单个脚本删除所有磁盘上的所有分区，而不管有多少磁盘。</p><p style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; line-height: 26px; widows: 1; background-color: rgb(255, 255, 255);">下表列出了 DiskPart 错误代码。</p><table border="0" style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; line-height: 26px; widows: 1; width: 708px; background-color: rgb(255, 255, 255);"><tbody><tr><th>错误</th><th>描述</th></tr><tr><td>0</td><td>没有出现错误。成功运行整个脚本。</td></tr><tr><td>1</td><td>出现致命异常。可能出现了严重问题。</td></tr><tr><td>2</td><td>为 DiskPart 命令指定的参数不正确。</td></tr><tr><td>3</td><td>DiskPart 无法打开指定的脚本或输出文件。</td></tr><tr><td>4</td><td>DiskPart 使用的服务之一返回失败。</td></tr><tr><td>5</td><td>出现命令语法错误。脚本失败，这是因为对象选择不正确，或与此命令一起使用时无效。<br/><div style="color:gray"><small>来源： &lt;<a href="http://blog.csdn.net/linfei2707/article/details/6543031">http://blog.csdn.net/linfei2707/article/details/6543031</a><small>&gt;</small></small></div><small><small> </small></small></td></tr></tbody></table></span>
</div></body></html> 