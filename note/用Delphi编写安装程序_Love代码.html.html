<html>
<head>
  <title>用Delphi编写安装程序_Love代码.html</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/306387 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="511"/>
<h1>用Delphi编写安装程序_Love代码.html</h1>

<div>
<span><p>   当你完成一个应用软件的开发后，那么你还需要为该软件做一个规范化的安装程序，这是程序设计的最后一步，同时也是很重要的一步，因为运行安装程序往往是用户做的第一步操作。</p><div>本文来Love代码 www.lvcode.com</div><p>　　很多报刊文章介绍了许多如何利用installshield等工具软件来制作安装程序的方法，这种办法可以很快建立起较常见的安装模式，但用这种办法也有一些不足，如做成的安装程序一般较大；风格较单一；不能灵活的控制启动方式和快捷方式。其实安装程序的的几个运行步骤较固定，我们完全可以自己来编写安装程序。下面就详细介绍如何用DELPHI编写具有自己软件特色的安装程序。 <span>本文来Love代码 www.lvcode.com</span></p><p>　　安装程序要达到的几个原则，如配置的一次性等，在有关杂志上已有许多文章介绍，就不再累述。这里主要介绍安装程序编写中几个主要过程：</p><div>本文内容来自 www.lvcode.com</div><p>1、将需要安装的程序制作成资源文件<br/>
　　Step 1:编写myres.rc资源脚本文件，可用记事本等编写。</p><p>本文内容来自 www.lvcode.com</p><p>　　MYDBSRC mydbsrcfile c:\resdemo\mynbdb.mdb</p><p>Love代码 www.lvcode.com</p><p>　　MYDBJET mydbjetfile c:\resdemo\mdac_typ.exe</p><div>Love代码 www.lvcode.com</div><p>　　MYDBAPP mydbappfile c:\resdemo\Tnbdemo.exe <span>本文来Love代码 www.lvcode.com</span></p><p>　　7001 Icon c:\resdemo\setup.ico <span>本文来Love代码 www.lvcode.com</span></p><p>　　Step 2:利用BRCC32编译生成资源文件myres.res。</p><div>本文来Love代码 www.lvcode.com</div><p>　　brcc32.exe myres.rc</p><p>本文来Love代码 www.lvcode.com</p><p>2、编写安装程序代码<br/>
　　Step 1: 在setup.dpr文件中加入{$R mymyres.RES} 语句，这样在编译文件时包含资源文件。</p><p>Love代码 www.lvcode.com</p><p>　　Step 2: 编写安装程序背景界面。 <font color="#FFFFFF">Love代码 www.lvcode.com</font></p><p>　　 //界面色彩渐变效果是通过用渐变的画刷刷绘依次相邻的矩形块实现的。 <font color="#FFFFFF">本文来Love代码 www.lvcode.com</font></p><p>　　//也可以实现其它特殊效果的安装界面。 <span>本文内容来自 www.lvcode.com</span></p><p>　　var i,j:Integer;</p><p>本文来Love代码 www.lvcode.com</p><p>　　Dct:TRect;</p><div>本文来Love代码 www.lvcode.com</div><p>　　begin <font color="#FFFFFF">本文内容来自 www.lvcode.com</font></p><p>　　form1.WindowState:=wsMaximized; <span>Love代码 www.lvcode.com</span></p><p>　　j:=form1.width;</p><div>Love代码 www.lvcode.com</div><p>　　//获得表单高度 <font color="#FFFFFF">Love代码 www.lvcode.com</font></p><p>　　for i:=0 to 255 do <font color="#FFFFFF">Love代码 www.lvcode.com</font></p><p>　　//此处设置RGB()中一个颜色值</p><div>本文来Love代码 www.lvcode.com</div><p>　　begin <font color="#FFFFFF">本文来Love代码 www.lvcode.com</font></p><p>　　Canvas.Brush.Color:=RGB(0,0,255-i); <span>本文内容来自 www.lvcode.com</span></p><p>　　//每次画矩形的画刷颜色 (左，上，右，下）</p><p>Love代码 www.lvcode.com</p><p>　　//Dct:=Rect(i*2,0,(i+1)*2,j);</p><div>本文来Love代码 www.lvcode.com</div><p>　　Dct:=Rect(0,i*2,j,(i+1)*3);</p><div>Love代码 www.lvcode.com</div><p>　　//每次刷绘的矩形区域</p><p>本文来Love代码 www.lvcode.com</p><p>　　Canvas.FillRect(Dct);</p><div>本文来Love代码 www.lvcode.com</div><p>　　Form1.Canvas.TextRect(Dct,30,40,'宁波大学课件管理系统 v1.0');</p><p>本文内容来自 www.lvcode.com</p><p>　　//填充颜色 <font color="#FFFFFF">本文来Love代码 www.lvcode.com</font></p><p>　　end; <span>本文内容来自 www.lvcode.com</span></p><p>　　end; <span>本文内容来自 www.lvcode.com</span></p><p>　　Step 3：创建主程序工作目录 <font color="#FFFFFF">Love代码 www.lvcode.com</font></p><p>　　//设置目录环境及配置文件 <span>Love代码 www.lvcode.com</span></p><p>　　if not DirectoryExists(EdtDir.Text) then</p><div>本文来Love代码 www.lvcode.com</div><p>　　//　　 if MessageBox(getfocus,'该目录不存在,是否创建该目录?','询问',1) = idOK then <font color="#FFFFFF">本文内容来自 www.lvcode.com</font></p><p>　　　　 try</p><div>本文来Love代码 www.lvcode.com</div><p>　　　　　　 ForceDirectories(EdtDir.Text);</p><p>本文来Love代码 www.lvcode.com</p><p>　　　　 except</p><p>本文内容来自 www.lvcode.com</p><p>　　　　　　 MessageBox(getFocus,'创建目录失败!','信息',0); <font color="#FFFFFF">本文来Love代码 www.lvcode.com</font></p><p>　　　　　　 Exit; <span>本文来Love代码 www.lvcode.com</span></p><p>　　　　 end <span>Love代码 www.lvcode.com</span></p><p>　　//　　 else Exit;</p><div>本文内容来自 www.lvcode.com</div><p>　　// ModalResult := mrOK; <font color="#FFFFFF">本文内容来自 www.lvcode.com</font></p><p>　　Step 4：生成主程序配置文件</p><p>本文来Love代码 www.lvcode.com</p><p>　　变量： <span>Love代码 www.lvcode.com</span></p><p>　　var</p><div>本文内容来自 www.lvcode.com</div><p>　　 setupinfo : TiniFile;</p><p>本文来Love代码 www.lvcode.com</p><p>　　//配置当前数据工作路径，选择与自己系统有关的驱动程序。 <span>本文来Love代码 www.lvcode.com</span></p><p>　　setupinfo:= Tinifile.Create( trim(FrmPathSelect.EdtDir.Text)+'\setup.ini');</p><div>Love代码 www.lvcode.com</div><p>　　setupinfo.WriteString('access','workdbpath',trim(FrmPathSelect.EdtDir.Text)+'\mynbdb.mdb';</p><div>本文来Love代码 www.lvcode.com</div><p>　　setupinfo.WriteString('access','backdbpath',trim(FrmPathSelect.EdtDir.Text)+'\mynbdbbak.mdb');</p><div>本文来Love代码 www.lvcode.com</div><p>　　setupinfo.Free;</p><div>Love代码 www.lvcode.com</div><p>　　Step 5:从资源文件中还原有关文件。</p><p>本文内容来自 www.lvcode.com</p><p>　　变量： <span>Love代码 www.lvcode.com</span></p><p>　　var</p><p>Love代码 www.lvcode.com</p><p>　　res:tresourcestream;</p><p>Love代码 www.lvcode.com</p><p>　　resname,resnewname:string;</p><p>Love代码 www.lvcode.com</p><p>　　RegFile:TRegIniFile; <font color="#FFFFFF">本文内容来自 www.lvcode.com</font></p><p>　　begin</p><div>本文来Love代码 www.lvcode.com</div><p>　　//从资源文件中还原数据库文件</p><div>Love代码 www.lvcode.com</div><p>　　resnewname:=trim(FrmPathSelect.EdtDir.Text)+'\mynbdb.mdb';</p><p>本文来Love代码 www.lvcode.com</p><p>　　 resname:='MYDBSRC';</p><p>本文内容来自 www.lvcode.com</p><p>　　 res:=tresourcestream.Create(hinstance,resname,pchar('mydbsrcfile')); <font color="#FFFFFF">本文来Love代码 www.lvcode.com</font></p><p>　　 res.savetofile(resnewname); <span>本文来Love代码 www.lvcode.com</span></p><p>　　 res.free; <font color="#FFFFFF">本文来Love代码 www.lvcode.com</font></p><p>　　//从资源文件中还原主程序文件</p><p>本文来Love代码 www.lvcode.com</p><p>　　resnewname:=trim(FrmPathSelect.EdtDir.Text)+'\Tnbdemo.exe';</p><p>Love代码 www.lvcode.com</p><p>　　 resname:='MYDBAPP';</p><div>本文内容来自 www.lvcode.com</div><p>　　 res:=tresourcestream.Create(hinstance,resname,pchar('mydbappfile'));</p><div>本文内容来自 www.lvcode.com</div><p>　　 res.savetofile(resnewname); <font color="#FFFFFF">Love代码 www.lvcode.com</font></p><p>　　 res.free; <font color="#FFFFFF">本文内容来自 www.lvcode.com</font></p><p>　　//在注册表中写入主程序路径名及执行文件名的信息，以便在</p><p>Love代码 www.lvcode.com</p><p>　　//升级主程序时用到。</p><p>Love代码 www.lvcode.com</p><p>　　 RegFile := TRegIniFile.Create;</p><div>本文内容来自 www.lvcode.com</div><p>　　 RegFile.RootKey := HKEY_LOCAL_MACHINE;</p><div>Love代码 www.lvcode.com</div><p>　　 RegFile.WriteString('SOFTWARE\mynb','exepath',trim(resnewname)); <span>本文来Love代码 www.lvcode.com</span></p><p>　　 RegFile.Free; <font color="#FFFFFF">本文来Love代码 www.lvcode.com</font></p><p>　　end <font color="#FFFFFF">Love代码 www.lvcode.com</font></p><p>　　Step 6：安装数据库驱动（与SETP 4对应）</p><div>本文来Love代码 www.lvcode.com</div><p>　　//安装数据库驱动程序</p><p>Love代码 www.lvcode.com</p><p>　　var <span>本文内容来自 www.lvcode.com</span></p><p>　　cmdlinepchar:array[0..120] of char; <span>Love代码 www.lvcode.com</span></p><p>　　startupinfo:tstartupinfo; <span>本文内容来自 www.lvcode.com</span></p><p>　　processinfo:tprocessinformation;</p><p>Love代码 www.lvcode.com</p><p>　　begin</p><p>本文内容来自 www.lvcode.com</p><p>　　 screen.cursor:=crhourglass; <span>本文内容来自 www.lvcode.com</span></p><p>　　 strpcopy(cmdlinepchar,trim(FrmPathSelect.EdtDir.Text)+'\mdac_typ.exe /q');</p><p>Love代码 www.lvcode.com</p><p>　　 fillchar(startupinfo,sizeof(startupinfo),#0); //置0 <font color="#FFFFFF">Love代码 www.lvcode.com</font></p><p>　　 with startupinfo do</p><p>本文内容来自 www.lvcode.com</p><p>　　 begin <span>本文来Love代码 www.lvcode.com</span></p><p>　　 cb:=sizeof(startupinfo); <font color="#FFFFFF">Love代码 www.lvcode.com</font></p><p>　　 dwflags:=startf_useshowwindow or startf_usestdhandles; <font color="#FFFFFF">Love代码 www.lvcode.com</font></p><p>　　 wshowwindow:=sw_hide; //隐藏被调用程序窗口</p><div>本文来Love代码 www.lvcode.com</div><p>　　 end; <span>本文来Love代码 www.lvcode.com</span></p><p>　　 if createprocess(nil,cmdlinepchar,nil,nil,true,0,nil,nil,startupinfo,processinfo) then</p><div>本文来Love代码 www.lvcode.com</div><p>　　 //创建进程</p><div>Love代码 www.lvcode.com</div><p>　　 begin <span>本文内容来自 www.lvcode.com</span></p><p>　　 waitforsingleobject(processinfo.HProcess,infinite); //等待进程结束</p><div>本文来Love代码 www.lvcode.com</div><p>　　end <font color="#FFFFFF">Love代码 www.lvcode.com</font></p><p>　　 else <span>本文来Love代码 www.lvcode.com</span></p><p>　　 begin <span>Love代码 www.lvcode.com</span></p><p>　　　　 exit;</p><div>Love代码 www.lvcode.com</div><p>　　 end;</p><p>本文来Love代码 www.lvcode.com</p><p>　　 screen.cursor:=crDEFAULT;</p><p>本文内容来自 www.lvcode.com</p><p>　　DeleteFile(PChar(trim(FrmPathSelect.EdtDir.Text)+'\mdac_typ.exe'));</p><div>Love代码 www.lvcode.com</div><p>　　end;</p><div>本文内容来自 www.lvcode.com</div><p>　　Step 7：创建程序组 <font color="#FFFFFF">Love代码 www.lvcode.com</font></p><p>　　变量：</p><p>Love代码 www.lvcode.com</p><p>　　var <font color="#FFFFFF">本文来Love代码 www.lvcode.com</font></p><p>　　smacro:string;</p><p>本文内容来自 www.lvcode.com</p><p>　　 szmacro:array[0..254] of char; <font color="#FFFFFF">本文内容来自 www.lvcode.com</font></p><p>　　 sgroupdesc,sgroupname:string;</p><p>本文来Love代码 www.lvcode.com</p><p>　　 sprogdesc:string; <font color="#FFFFFF">本文内容来自 www.lvcode.com</font></p><p>　　 sprogicon:string; <font color="#FFFFFF">本文内容来自 www.lvcode.com</font></p><p>　　//创建主程序组 <span>本文内容来自 www.lvcode.com</span></p><p>　　　　//打开对话通路</p><div>本文内容来自 www.lvcode.com</div><p>　　 if ddeclientconv1.OpenLink then <span>本文来Love代码 www.lvcode.com</span></p><p>　　 begin</p><div>本文内容来自 www.lvcode.com</div><p>　　　　 //建立组群</p><p>本文来Love代码 www.lvcode.com</p><p>　　　　 sgroupdesc:='宁波大学课件管理系统 ';</p><p>本文来Love代码 www.lvcode.com</p><p>　　　　 sgroupname:='宁波大学课件管理系统 v1.0';</p><p>Love代码 www.lvcode.com</p><p>　　　　 //组成宏指令 <font color="#FFFFFF">本文内容来自 www.lvcode.com</font></p><p>　　　　 smacro:='[creategroup('+sgroupdesc+','+sgroupname+')]';</p><div>本文内容来自 www.lvcode.com</div><p>　　　　 strpcopy(szmacro,smacro);　　　　　　　　　　 //转成null-term 字串</p><p>本文来Love代码 www.lvcode.com</p><p>　　　　 ddeclientconv1.ExecuteMacro(szmacro,false); //执行宏指令</p><div>Love代码 www.lvcode.com</div><p>　　　　 //建立ICON图像 <span>本文来Love代码 www.lvcode.com</span></p><p>　　　　 sprogicon:=trim(FrmPathSelect.EdtDir.Text)+'\Tnbdemo.exe';; <font color="#FFFFFF">本文来Love代码 www.lvcode.com</font></p><p>　　　　 sprogdesc:='宁波大学课件管理系统';</p><div>Love代码 www.lvcode.com</div><p>　　　　 smacro:='[additem('+sprogicon+','+sprogdesc+')]'; <font color="#FFFFFF">本文内容来自 www.lvcode.com</font></p><p>　　　　 strpcopy(szmacro,smacro); <font color="#FFFFFF">本文来Love代码 www.lvcode.com</font></p><p>　　　　 ddeclientconv1.ExecuteMacro(szmacro,false); <span>Love代码 www.lvcode.com</span></p><p>　　　　 ddeclientconv1.CloseLink; <font color="#FFFFFF">Love代码 www.lvcode.com</font></p><p>　　 end;</p><p>Love代码 www.lvcode.com</p><p>　　Step 8：创建桌面快捷方式</p><div>本文内容来自 www.lvcode.com</div><p>　　//uses shlobj,comobj,activex;</p><p>本文内容来自 www.lvcode.com</p><p>　　var</p><p>本文内容来自 www.lvcode.com</p><p>　　tmpObject:IUnknown;</p><div>本文来Love代码 www.lvcode.com</div><p>　　tmpSLink:IShellLink; <span>本文来Love代码 www.lvcode.com</span></p><p>　　tmpPFile:IPersistFile; <span>本文来Love代码 www.lvcode.com</span></p><p>　　PIDL:PItemIDList; <span>本文来Love代码 www.lvcode.com</span></p><p>　　StartupDirectory : array[0..MAX_PATH] of Char;</p><div>本文内容来自 www.lvcode.com</div><p>　　StartupFilename : String;</p><p>本文来Love代码 www.lvcode.com</p><p>　　LinkFilename : WideString;</p><p>本文内容来自 www.lvcode.com</p><p>　　c1:THandle; <span>本文内容来自 www.lvcode.com</span></p><p>　　begin</p><div>本文内容来自 www.lvcode.com</div><p>　　StartupFilename := ''Tnbdemo.exe''; <font color="#FFFFFF">本文来Love代码 www.lvcode.com</font></p><p>　　tmpObject := CreateComObject(CLSID_ShellLink);</p><div>Love代码 www.lvcode.com</div><p>　　tmpSLink := tmpObject as IShellLink;</p><div>Love代码 www.lvcode.com</div><p>　　tmpPFile := tmpObject as IPersistfile;</p><div>本文内容来自 www.lvcode.com</div><p>　　tmpSLink.SetPath(pChar(StartupFilename));</p><div>本文来Love代码 www.lvcode.com</div><p>　　tmpSLink.SetWorkingDirectory(pChar(ExtractFilePath(StartupFilename)));</p><div>本文来Love代码 www.lvcode.com</div><p>　　SHGetSpecialFolderLocation(0,CSIDL_DESKTOPDIRECTORY,PIDL); <font color="#FFFFFF">本文来Love代码 www.lvcode.com</font></p><p>　　SHGetPathFromIDList(PIDL,StartupDirectory);</p><div>Love代码 www.lvcode.com</div><p>　　LinkFilename := StartupDirectory + '\mynotepad.lnk'; <font color="#FFFFFF">Love代码 www.lvcode.com</font></p><p>　　showmessage(linkfilename); <font color="#FFFFFF">本文来Love代码 www.lvcode.com</font></p><p>　　tmpPFile.Save(pWChar(LinkFilename),FALSE);</p><p>Love代码 www.lvcode.com</p><p>　　c1:=windows.FindWindowEx(windows.FindWindowEx(windows.FindWindow('Progman','Program Manager'),0,'SHELLDLL_DefView',''),0,'SysListView32','');</p><p>本文内容来自 www.lvcode.com</p><p>　　PostMessage(c1,WM_KEYDOWN,VK_F5,0); <span>Love代码 www.lvcode.com</span></p><p>　　PostMessage(c1,WM_KEYUP,VK_F5,1 shl 31); <span>Love代码 www.lvcode.com</span></p><p>　　end;</p><div>本文来Love代码 www.lvcode.com</div><p>　　Step 9：重新启动机器</p><div>本文内容来自 www.lvcode.com</div><p>　　begin</p><p>本文内容来自 www.lvcode.com</p><p>　　 ExitWindowsEx(2,0); <font color="#FFFFFF">本文来Love代码 www.lvcode.com</font></p><p>　　end; <font color="#FFFFFF">本文内容来自 www.lvcode.com</font></p><p>　　以上是程序的主要语句部分，从本人的开发系统中剪出来，用到了一些WIN API的调用。在安装过程中的一些提示性界面及每一个步骤大家可以根据自己的需要而制作，这样做出来的安装程序精练，而且风格可以做的很特别。<br/><br/>
 </p><p>本文内容来自 www.lvcode.com</p>
(责任编辑：admin)
</span>
</div></body></html> 