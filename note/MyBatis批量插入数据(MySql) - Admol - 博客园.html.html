<html>
<head>
  <title>MyBatis批量插入数据(MySql) - Admol - 博客园.html</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/306387 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="671"/>
<h1>MyBatis批量插入数据(MySql) - Admol - 博客园.html</h1>

<div>
<span><h1 style="margin: 0px; padding: 0px 0px 0px 5px; font-size: 14px; float: left; width: 1516.11px; clear: both; font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif; widows: 1; background-color: rgb(255, 255, 255);"><a href="http://www.cnblogs.com/admol/articles/4248159.html" style="margin: 0px; padding: 0px; color: rgb(51, 51, 51); text-decoration: none;">MyBatis批量插入数据(MySql)</a></h1><div style="margin: 5px 0px 0px; padding: 5px 2px 5px 5px; font-size: 13px; font-family: verdana, 'ms song', 宋体, Arial, 微软雅黑, Helvetica, sans-serif; widows: 1; background-color: rgb(255, 255, 255);"><div style="margin: 0px 0px 20px; padding: 0px; word-break: break-word;"><p style="margin: 10px auto; padding: 0px;"> </p><div style="margin: 0px; padding: 0px;">由于项目需要生成多条数据，并保存到数据库当中，在程序中封装了一个List集合对象，然后需要把该集合中的实体插入到数据库中,项目使用了Spring+MyBatis，所以打算使用MyBatis批量插入，应该要比循环插入的效果更好,由于之前没用过批量插入，在网上找了一些资料后最终实现了，把详细过程贴出来。供以后查阅和学习。</div><div style="margin: 0px; padding: 0px;"> </div><div style="margin: 0px; padding: 0px;"> </div><div style="margin: 0px; padding: 0px;">java代码：</div><div style="margin: 0px; padding: 0px;"><img style="margin: 0px; padding: 0px; border: 0px; max-width: 900px; height: auto;"></img></div><div style="margin: 0px; padding: 0px;">注意：这里循环的时候需new 出来新的对象，而不能通过循环改变属性的值就认为这是一个新的对象了,通俗的说就是new ReddemCode()要放在for循环的里面.</div><div style="margin: 0px; padding: 0px;"><div style="margin: 0px; padding: 0px;"><strong style="margin: 0px; padding: 0px;">xxxMapper.xml</strong></div></div><div style="margin: 0px; padding: 0px;"><div style="margin: 5px 0px; padding: 5px; border: 1px solid rgb(204, 204, 204); overflow: auto; background-color: rgb(245, 245, 245); font-family: 'Courier New' !important; font-size: 12px !important;"><div style="margin: 5px 0px 0px; padding: 0px;"><span style="margin: 0px; padding: 0px 5px 0px 0px;"><a style="margin: 0px; padding: 0px; color: rgb(51, 51, 51); border: none !important;" title="复制代码"><img src="MyBatis批量插入数据(MySql) - Admol - 博客园.html_files/Image.gif" type="image/gif" data-filename="Image.gif" alt="复制代码" style="margin: 0px; padding: 0px; max-width: 900px; border: none !important; height: auto;"/></a></span></div><pre style="margin-top: 0px; margin-bottom: 0px; padding: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: 'Courier New' !important;"><span style="margin: 0px; padding: 0px; color: rgb(0, 128, 128);"> 1</span> <span style="margin: 0px; padding: 0px; color: rgb(0, 128, 0);">&lt;!--</span><span style="margin: 0px; padding: 0px; color: rgb(0, 128, 0);"> 批量插入生成的兑换码 </span><span style="margin: 0px; padding: 0px; color: rgb(0, 128, 0);">--&gt;</span><span style="margin: 0px; padding: 0px; color: rgb(0, 128, 128);"> 2</span>      <span style="margin: 0px; padding: 0px; color: rgb(0, 0, 255);">&lt;</span><span style="margin: 0px; padding: 0px; color: rgb(128, 0, 0);">insert </span><span style="margin: 0px; padding: 0px; color: rgb(255, 0, 0);">id </span><span style="margin: 0px; padding: 0px; color: rgb(0, 0, 255);">=&quot;insertCodeBatch&quot;</span><span style="margin: 0px; padding: 0px; color: rgb(255, 0, 0);"> parameterType</span><span style="margin: 0px; padding: 0px; color: rgb(0, 0, 255);">=&quot;java.util.List&quot;</span> <span style="margin: 0px; padding: 0px; color: rgb(0, 0, 255);">&gt;</span><span style="margin: 0px; padding: 0px; color: rgb(0, 128, 128);"> 3</span>             <span style="margin: 0px; padding: 0px; color: rgb(0, 0, 255);">&lt;</span><span style="margin: 0px; padding: 0px; color: rgb(128, 0, 0);">selectKey </span><span style="margin: 0px; padding: 0px; color: rgb(255, 0, 0);">resultType </span><span style="margin: 0px; padding: 0px; color: rgb(0, 0, 255);">=&quot;java.lang.Integer&quot;</span><span style="margin: 0px; padding: 0px; color: rgb(255, 0, 0);"> keyProperty</span><span style="margin: 0px; padding: 0px; color: rgb(0, 0, 255);">= &quot;id&quot;</span><span style="margin: 0px; padding: 0px; color: rgb(0, 128, 128);"> 4</span> <span style="margin: 0px; padding: 0px; color: rgb(255, 0, 0);">                 order</span><span style="margin: 0px; padding: 0px; color: rgb(0, 0, 255);">= &quot;AFTER&quot;</span><span style="margin: 0px; padding: 0px; color: rgb(0, 0, 255);">&gt;</span><span style="margin: 0px; padding: 0px; color: rgb(0, 128, 128);"> 5</span> <span style="margin: 0px; padding: 0px;">                SELECT LAST_INSERT_ID()
</span><span style="margin: 0px; padding: 0px; color: rgb(0, 128, 128);"> 6</span>             <span style="margin: 0px; padding: 0px; color: rgb(0, 0, 255);">&lt;/</span><span style="margin: 0px; padding: 0px; color: rgb(128, 0, 0);">selectKey </span><span style="margin: 0px; padding: 0px; color: rgb(0, 0, 255);">&gt;</span><span style="margin: 0px; padding: 0px; color: rgb(0, 128, 128);"> 7</span> <span style="margin: 0px; padding: 0px;">           insert into redeem_code
</span><span style="margin: 0px; padding: 0px; color: rgb(0, 128, 128);"> 8</span> <span style="margin: 0px; padding: 0px;">           (bach_id, code, type, facevalue,create_user,create_time)
</span><span style="margin: 0px; padding: 0px; color: rgb(0, 128, 128);"> 9</span> <span style="margin: 0px; padding: 0px;">           values
</span><span style="margin: 0px; padding: 0px; color: rgb(0, 128, 128);">10</span>             <span style="margin: 0px; padding: 0px; color: rgb(0, 0, 255);">&lt;</span><span style="margin: 0px; padding: 0px; color: rgb(128, 0, 0);">foreach </span><span style="margin: 0px; padding: 0px; color: rgb(255, 0, 0);">collection </span><span style="margin: 0px; padding: 0px; color: rgb(0, 0, 255);">=&quot;list&quot;</span><span style="margin: 0px; padding: 0px; color: rgb(255, 0, 0);"> item</span><span style="margin: 0px; padding: 0px; color: rgb(0, 0, 255);">=&quot;reddemCode&quot;</span><span style="margin: 0px; padding: 0px; color: rgb(255, 0, 0);"> index</span><span style="margin: 0px; padding: 0px; color: rgb(0, 0, 255);">= &quot;index&quot;</span><span style="margin: 0px; padding: 0px; color: rgb(255, 0, 0);"> separator </span><span style="margin: 0px; padding: 0px; color: rgb(0, 0, 255);">=&quot;,&quot;</span><span style="margin: 0px; padding: 0px; color: rgb(0, 0, 255);">&gt;</span><span style="margin: 0px; padding: 0px; color: rgb(0, 128, 128);">11</span> <span style="margin: 0px; padding: 0px;">                (
</span><span style="margin: 0px; padding: 0px; color: rgb(0, 128, 128);">12</span> <span style="margin: 0px; padding: 0px;">                #{reddemCode.batchId}, #{reddemCode.code},
</span><span style="margin: 0px; padding: 0px; color: rgb(0, 128, 128);">13</span> <span style="margin: 0px; padding: 0px;">                #{reddemCode.type},
</span><span style="margin: 0px; padding: 0px; color: rgb(0, 128, 128);">14</span> <span style="margin: 0px; padding: 0px;">                #{reddemCode.facevalue},
</span><span style="margin: 0px; padding: 0px; color: rgb(0, 128, 128);">15</span> <span style="margin: 0px; padding: 0px;">                #{reddemCode.createUser}, #{reddemCode.createTime}
</span><span style="margin: 0px; padding: 0px; color: rgb(0, 128, 128);">16</span> <span style="margin: 0px; padding: 0px;">                )
</span><span style="margin: 0px; padding: 0px; color: rgb(0, 128, 128);">17</span>             <span style="margin: 0px; padding: 0px; color: rgb(0, 0, 255);">&lt;/</span><span style="margin: 0px; padding: 0px; color: rgb(128, 0, 0);">foreach </span><span style="margin: 0px; padding: 0px; color: rgb(0, 0, 255);">&gt;</span><span style="margin: 0px; padding: 0px; color: rgb(0, 128, 128);">18</span>      <span style="margin: 0px; padding: 0px; color: rgb(0, 0, 255);">&lt;/</span><span style="margin: 0px; padding: 0px; color: rgb(128, 0, 0);">insert </span><span style="margin: 0px; padding: 0px; color: rgb(0, 0, 255);">&gt;</span></pre><div style="margin: 5px 0px 0px; padding: 0px;"><span style="margin: 0px; padding: 0px 5px 0px 0px;"><a style="margin: 0px; padding: 0px; color: rgb(51, 51, 51); border: none !important;" title="复制代码"><img src="MyBatis批量插入数据(MySql) - Admol - 博客园.html_files/Image [1].gif" type="image/gif" data-filename="Image.gif" alt="复制代码" style="margin: 0px; padding: 0px; max-width: 900px; border: none !important; height: auto;"/></a></span></div></div><p style="margin: 10px auto; padding: 0px;"> </p></div><div style="margin: 0px; padding: 0px;"><div style="margin: 0px; padding: 0px;">xxxMapper.java(部分)</div></div><div style="margin: 0px; padding: 0px;"> </div><div style="margin: 0px; padding: 0px;"><div style="margin: 5px 0px; padding: 5px; border: 1px solid rgb(204, 204, 204); overflow: auto; background-color: rgb(245, 245, 245); font-family: 'Courier New' !important; font-size: 12px !important;"><pre style="margin-top: 0px; margin-bottom: 0px; padding: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: 'Courier New' !important;"><span style="margin: 0px; padding: 0px; color: rgb(0, 128, 128);">1</span> <span style="margin: 0px; padding: 0px; color: rgb(0, 0, 255);">int</span> insertCodeBatch(List&lt;ReddemCode &gt; reddemCodeList);
</pre></div>
 
<div style="margin: 0px; padding: 0px;"><p style="margin: 10px auto; padding: 0px;">对于foreach标签的解释参考了网上的资料，具体如下：</p><p style="margin: 10px auto; padding: 0px;">foreach的主要用在构建in条件中，它可以在SQL语句中进行迭代一个集合。</p><p style="margin: 10px auto; padding: 0px;">foreach元素的属性主要有 item，index，collection，open，separator，close。</p><p style="margin: 10px auto; padding: 0px;">item表示集合中每一个元素进行迭代时的别名，index指定一个名字，用于表示在迭代过程中，每次迭代到的位置，open表示该语句以什么开始，separator表示在每次进行迭代之间以什么符号作为分隔 符，close表示以什么结束，在使用foreach的时候最关键的也是最容易出错的就是collection属性，该属性是必须指定的，但是在不同情况 下，该属性的值是不一样的，主要有一下3种情况：</p><p style="margin: 10px auto; padding: 0px;">1.如果传入的是单参数且参数类型是一个List的时候，collection属性值为list</p><p style="margin: 10px auto; padding: 0px;">2.如果传入的是单参数且参数类型是一个array数组的时候，collection的属性值为array</p><p style="margin: 10px auto; padding: 0px;">3.如果传入的参数是多个的时候，我们就需要把它们封装成一个Map了，当然单参数也可以封装成map</p></div></div><div style="margin: 0px; padding: 0px;"> </div><div style="margin: 0px; padding: 0px;">使用批量插入执行的SQL语句应该等价于：</div><div style="margin: 0px; padding: 0px;"> </div><div style="margin: 0px; padding: 0px;"><div style="margin: 5px 0px; padding: 5px; border: 1px solid rgb(204, 204, 204); overflow: auto; background-color: rgb(245, 245, 245); font-family: 'Courier New' !important; font-size: 12px !important;"><pre style="margin-top: 0px; margin-bottom: 0px; padding: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: 'Courier New' !important;">
 <span style="margin: 0px; padding: 0px; color: rgb(0, 0, 255);">insert</span> <span style="margin: 0px; padding: 0px; color: rgb(0, 0, 255);">into</span><span style="margin: 0px; padding: 0px;"> redeem_code (batch_id, code, type, facevalue,create_user,create_time)
 </span><span style="margin: 0px; padding: 0px; color: rgb(0, 0, 255);">values</span><span style="margin: 0px; padding: 0px;">
 (?,?,?,?,?,? ),(?,?,?,?,?,? ),(?,?,?,?,?,? ),(?,?,?,?,?,? )</span></pre><br/><div style="color:gray"><small>来源： <a href="http://www.cnblogs.com/admol/articles/4248159.html">http://www.cnblogs.com/admol/articles/4248159.html</a></small></div></div></div></div></div></span>
</div></body></html> 