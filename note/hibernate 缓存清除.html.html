<html>
<head>
  <title>hibernate 缓存清除.html</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/306387 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="628"/>
<h1>hibernate 缓存清除.html</h1>

<div>
<span><div style="width: 1018px;"><div style="width: 688px;"><div style="width: 662px;"><div><table><tbody><tr><td><div style="border: 0px none rgb(46, 46, 46); color: rgb(46, 46, 46); display: block; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; font-family: &quot;microsoft yahei&quot;, arial, simsun; height: 1230px; line-height: 24px; margin: 0px; outline: rgb(46, 46, 46) none 0px; padding: 0px; text-align: left; text-decoration: none; width: 656px; word-break: break-all;"><font color="#0066FF" style="border: 0px none rgb(0, 102, 255); color: rgb(0, 102, 255); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; font-family: &quot;microsoft yahei&quot;, arial, simsun; line-height: 24px; margin: 0px; outline: rgb(0, 102, 255) none 0px; padding: 0px; text-align: left; text-decoration: none; word-break: break-all;"><strong style="border: 0px none rgb(0, 102, 255); color: rgb(0, 102, 255); display: inline; font-style: normal; font-variant: normal; font-weight: bold; font-stretch: normal; font-size: 16px; font-family: &quot;microsoft yahei&quot;, arial, simsun; line-height: 24px; margin: 0px; outline: rgb(0, 102, 255) none 0px; padding: 0px; text-align: left; text-decoration: none; word-break: break-all;">一、hibernate<span style="border: 0px none rgb(0, 102, 255); color: rgb(0, 102, 255); display: inline; font-style: normal; font-variant: normal; font-weight: bold; font-stretch: normal; font-size: 16px; font-family: 幼圆; line-height: 24px; margin: 0px; outline: rgb(0, 102, 255) none 0px; padding: 0px; text-align: left; text-decoration: none; word-break: break-all;">一级缓存</span><br style="COLOR: rgb(0,102,255)"/></strong><span style="border: 0px none rgb(0, 102, 255); color: rgb(0, 102, 255); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; font-family: &quot;microsoft yahei&quot;, arial, simsun; line-height: 24px; margin: 0px; outline: rgb(0, 102, 255) none 0px; padding: 0px; text-align: left; text-decoration: none; word-break: break-all;">（1）hibernate支持两个级别的缓存，默认只支持一级缓存；</span></font><br style="COLOR: rgb(0,102,255)"/><span style="border: 0px none rgb(0, 102, 255); color: rgb(0, 102, 255); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; font-family: &quot;microsoft yahei&quot;, arial, simsun; line-height: 24px; margin: 0px; outline: rgb(0, 102, 255) none 0px; padding: 0px; text-align: left; text-decoration: none; word-break: break-all;">（2）每个Session内部自带一个一级缓存；</span><br style="COLOR: rgb(0,102,255)"/><span style="border: 0px none rgb(0, 102, 255); color: rgb(0, 102, 255); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; font-family: &quot;microsoft yahei&quot;, arial, simsun; line-height: 24px; margin: 0px; outline: rgb(0, 102, 255) none 0px; padding: 0px; text-align: left; text-decoration: none; word-break: break-all;">（3）某个Session被关闭时，其对应的一级缓存自动清除；</span><br style="COLOR: rgb(0,102,255)"/><span style="border: 0px none rgb(0, 102, 255); color: rgb(0, 102, 255); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; font-family: &quot;microsoft yahei&quot;, arial, simsun; line-height: 24px; margin: 0px; outline: rgb(0, 102, 255) none 0px; padding: 0px; text-align: left; text-decoration: none; word-break: break-all;">（4）save、update、saveOrupdate、load、get、list、iterate、lock方法都会向缓存中存对象.</span><br style="COLOR: rgb(0,102,255)"/><span style="border: 0px none rgb(0, 102, 255); color: rgb(0, 102, 255); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; font-family: &quot;microsoft yahei&quot;, arial, simsun; line-height: 24px; margin: 0px; outline: rgb(0, 102, 255) none 0px; padding: 0px; text-align: left; text-decoration: none; word-break: break-all;">（5）可以从缓存中读数据的只有： get、load、iterate</span><br style="COLOR: rgb(0,102,255)"/><span style="border: 0px none rgb(0, 102, 255); color: rgb(0, 102, 255); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; font-family: &quot;microsoft yahei&quot;, arial, simsun; line-height: 24px; margin: 0px; outline: rgb(0, 102, 255) none 0px; padding: 0px; text-align: left; text-decoration: none; word-break: break-all;">（6）Query对象默认情况下不读缓存，如果要使其支持缓存，则要通过语法：</span><br style="COLOR: rgb(0,102,255)"/><span style="border: 0px none rgb(0, 102, 255); color: rgb(0, 102, 255); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; font-family: &quot;microsoft yahei&quot;, arial, simsun; line-height: 24px; margin: 0px; outline: rgb(0, 102, 255) none 0px; padding: 0px; text-align: left; text-decoration: none; word-break: break-all;">query.setCacheable(true)；</span><br style="COLOR: rgb(0,102,255)"/><span style="border: 0px none rgb(0, 102, 255); color: rgb(0, 102, 255); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; font-family: &quot;microsoft yahei&quot;, arial, simsun; line-height: 24px; margin: 0px; outline: rgb(0, 102, 255) none 0px; padding: 0px; text-align: left; text-decoration: none; word-break: break-all;">&lt;property name=&quot;cache.use_query_cache&quot;&gt;true&lt;/property&gt;</span><br style="COLOR: rgb(0,102,255)"/><span style="border: 0px none rgb(0, 102, 255); color: rgb(0, 102, 255); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; font-family: &quot;microsoft yahei&quot;, arial, simsun; line-height: 24px; margin: 0px; outline: rgb(0, 102, 255) none 0px; padding: 0px; text-align: left; text-decoration: none; word-break: break-all;">（7）打开query缓存后，只有查询条件与以前的查询完全相同时，才会在缓存中匹配成功.</span><br style="COLOR: rgb(0,102,255)"/><span style="border: 0px none rgb(0, 102, 255); color: rgb(0, 102, 255); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; font-family: &quot;microsoft yahei&quot;, arial, simsun; line-height: 24px; margin: 0px; outline: rgb(0, 102, 255) none 0px; padding: 0px; text-align: left; text-decoration: none; word-break: break-all;">（8）Criteria对缓存支持不足；</span><br style="COLOR: rgb(0,102,255)"/><span style="border: 0px none rgb(0, 102, 255); color: rgb(0, 102, 255); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; font-family: &quot;microsoft yahei&quot;, arial, simsun; line-height: 24px; margin: 0px; outline: rgb(0, 102, 255) none 0px; padding: 0px; text-align: left; text-decoration: none; word-break: break-all;">（9）一级缓存不能控制缓存中的对象数量，要注意大批量操作数据时可能造成的内存溢出，可以利用清除缓存.</span><br style="COLOR: rgb(0,102,255)"/><span style="border: 0px none rgb(0, 102, 255); color: rgb(0, 102, 255); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; font-family: &quot;microsoft yahei&quot;, arial, simsun; line-height: 24px; margin: 0px; outline: rgb(0, 102, 255) none 0px; padding: 0px; text-align: left; text-decoration: none; word-break: break-all;">     session.clear()  清除缓存中所有对象</span><br style="COLOR: rgb(0,102,255)"/><span style="border: 0px none rgb(0, 102, 255); color: rgb(0, 102, 255); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; font-family: &quot;microsoft yahei&quot;, arial, simsun; line-height: 24px; margin: 0px; outline: rgb(0, 102, 255) none 0px; padding: 0px; text-align: left; text-decoration: none; word-break: break-all;">     session.evict(user) 清除指定对象</span><br style="COLOR: rgb(0,102,255)"/><br style="COLOR: rgb(0,102,255)"/><br style="COLOR: rgb(0,102,255)"/><font style="border: 0px none rgb(46, 46, 46); color: rgb(46, 46, 46); display: inline; font-style: normal; font-variant: normal; font-weight: bold; font-stretch: normal; font-size: 20px; font-family: 黑体; line-height: 30px; margin: 0px; outline: rgb(46, 46, 46) none 0px; padding: 0px; text-align: left; text-decoration: none; word-break: break-all;"><span style="border: 0px none rgb(0, 102, 255); color: rgb(0, 102, 255); display: inline; font-style: normal; font-variant: normal; font-weight: bold; font-stretch: normal; font-size: 20px; font-family: 黑体; line-height: 30px; margin: 0px; outline: rgb(0, 102, 255) none 0px; padding: 0px; text-align: left; text-decoration: none; word-break: break-all;">二、hibernate二级缓存</span></font><br style="COLOR: rgb(0,102,255)"/><span style="border: 0px none rgb(0, 102, 255); color: rgb(0, 102, 255); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; font-family: &quot;microsoft yahei&quot;, arial, simsun; line-height: 24px; margin: 0px; outline: rgb(0, 102, 255) none 0px; padding: 0px; text-align: left; text-decoration: none; word-break: break-all;">* save、update、saveOrupdate、load、get、list、query、Criteria方法都会填充二级缓存</span><br style="COLOR: rgb(0,102,255)"/><span style="border: 0px none rgb(0, 102, 255); color: rgb(0, 102, 255); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; font-family: &quot;microsoft yahei&quot;, arial, simsun; line-height: 24px; margin: 0px; outline: rgb(0, 102, 255) none 0px; padding: 0px; text-align: left; text-decoration: none; word-break: break-all;">* get、load、iterate会从二级缓存中取数据</span><br style="COLOR: rgb(0,102,255)"/><span style="border: 0px none rgb(0, 102, 255); color: rgb(0, 102, 255); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; font-family: &quot;microsoft yahei&quot;, arial, simsun; line-height: 24px; margin: 0px; outline: rgb(0, 102, 255) none 0px; padding: 0px; text-align: left; text-decoration: none; word-break: break-all;">* session.save(user)   如果user主键使用“native”生成，则不放入二级缓存.</span><br style="COLOR: rgb(0,102,255)"/><br style="COLOR: rgb(0,102,255)"/><span style="border: 0px none rgb(0, 102, 255); color: rgb(0, 102, 255); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; font-family: &quot;microsoft yahei&quot;, arial, simsun; line-height: 24px; margin: 0px; outline: rgb(0, 102, 255) none 0px; padding: 0px; text-align: left; text-decoration: none; word-break: break-all;">(1)开启二级缓存</span><br style="COLOR: rgb(0,102,255)"/><span style="border: 0px none rgb(0, 102, 255); color: rgb(0, 102, 255); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; font-family: &quot;microsoft yahei&quot;, arial, simsun; line-height: 24px; margin: 0px; outline: rgb(0, 102, 255) none 0px; padding: 0px; text-align: left; text-decoration: none; word-break: break-all;">&lt;property name=&quot;cache.use_second_level_cache&quot;&gt;true&lt;/property&gt;</span><br style="COLOR: rgb(0,102,255)"/><br style="COLOR: rgb(0,102,255)"/><span style="border: 0px none rgb(0, 102, 255); color: rgb(0, 102, 255); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; font-family: &quot;microsoft yahei&quot;, arial, simsun; line-height: 24px; margin: 0px; outline: rgb(0, 102, 255) none 0px; padding: 0px; text-align: left; text-decoration: none; word-break: break-all;">(2)为hibernate指定二级缓存的实现类</span><br style="COLOR: rgb(0,102,255)"/><span style="border: 0px none rgb(0, 102, 255); color: rgb(0, 102, 255); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; font-family: &quot;microsoft yahei&quot;, arial, simsun; line-height: 24px; margin: 0px; outline: rgb(0, 102, 255) none 0px; padding: 0px; text-align: left; text-decoration: none; word-break: break-all;">&lt;property name=&quot;cache.provider_class&quot;&gt;</span><br style="COLOR: rgb(0,102,255)"/><span style="border: 0px none rgb(0, 102, 255); color: rgb(0, 102, 255); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; font-family: &quot;microsoft yahei&quot;, arial, simsun; line-height: 24px; margin: 0px; outline: rgb(0, 102, 255) none 0px; padding: 0px; text-align: left; text-decoration: none; word-break: break-all;">    org.hibernate.cache.OSCacheProvider</span><br style="COLOR: rgb(0,102,255)"/><span style="border: 0px none rgb(0, 102, 255); color: rgb(0, 102, 255); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; font-family: &quot;microsoft yahei&quot;, arial, simsun; line-height: 24px; margin: 0px; outline: rgb(0, 102, 255) none 0px; padding: 0px; text-align: left; text-decoration: none; word-break: break-all;">&lt;/property&gt;</span><br style="COLOR: rgb(0,102,255)"/><br style="COLOR: rgb(0,102,255)"/><span style="border: 0px none rgb(0, 102, 255); color: rgb(0, 102, 255); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; font-family: &quot;microsoft yahei&quot;, arial, simsun; line-height: 24px; margin: 0px; outline: rgb(0, 102, 255) none 0px; padding: 0px; text-align: left; text-decoration: none; word-break: break-all;">(3)为OSCache缓存创建配置文件(需要hibernate_Advance_Surpport_lib)</span><br style="COLOR: rgb(0,102,255)"/><span style="border: 0px none rgb(0, 102, 255); color: rgb(0, 102, 255); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; font-family: &quot;microsoft yahei&quot;, arial, simsun; line-height: 24px; margin: 0px; outline: rgb(0, 102, 255) none 0px; padding: 0px; text-align: left; text-decoration: none; word-break: break-all;">src/oscache.properties</span><br style="COLOR: rgb(0,102,255)"/><span style="border: 0px none rgb(0, 102, 255); color: rgb(0, 102, 255); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; font-family: &quot;microsoft yahei&quot;, arial, simsun; line-height: 24px; margin: 0px; outline: rgb(0, 102, 255) none 0px; padding: 0px; text-align: left; text-decoration: none; word-break: break-all;">修改配置中的:</span><br style="COLOR: rgb(0,102,255)"/><span style="border: 0px none rgb(0, 102, 255); color: rgb(0, 102, 255); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; font-family: &quot;microsoft yahei&quot;, arial, simsun; line-height: 24px; margin: 0px; outline: rgb(0, 102, 255) none 0px; padding: 0px; text-align: left; text-decoration: none; word-break: break-all;">cache.capacity=1000  指定缓存可以容纳多少对象</span><br style="COLOR: rgb(0,102,255)"/><br style="COLOR: rgb(0,102,255)"/><br style="COLOR: rgb(0,102,255)"/><span style="border: 0px none rgb(0, 102, 255); color: rgb(0, 102, 255); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; font-family: &quot;microsoft yahei&quot;, arial, simsun; line-height: 24px; margin: 0px; outline: rgb(0, 102, 255) none 0px; padding: 0px; text-align: left; text-decoration: none; word-break: break-all;">(4)指明哪些类需要放入二级缓存，需要长期使用到的对象才有必要放入二级缓存</span><br style="COLOR: rgb(0,102,255)"/><span style="border: 0px none rgb(0, 102, 255); color: rgb(0, 102, 255); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; font-family: &quot;microsoft yahei&quot;, arial, simsun; line-height: 24px; margin: 0px; outline: rgb(0, 102, 255) none 0px; padding: 0px; text-align: left; text-decoration: none; word-break: break-all;">&lt;class-cache class=&quot;entity.PetInfo&quot; usage=&quot;read-only&quot; /&gt; //不允许更新缓存中的对象</span><br style="COLOR: rgb(0,102,255)"/><span style="border: 0px none rgb(0, 102, 255); color: rgb(0, 102, 255); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; font-family: &quot;microsoft yahei&quot;, arial, simsun; line-height: 24px; margin: 0px; outline: rgb(0, 102, 255) none 0px; padding: 0px; text-align: left; text-decoration: none; word-break: break-all;">&lt;class-cache class=&quot;entity.PetInfo&quot; usage=&quot;read-write&quot; /&gt;  //允许更新缓存中的对象</span><br style="COLOR: rgb(0,102,255)"/><br style="COLOR: rgb(0,102,255)"/><span style="border: 0px none rgb(0, 102, 255); color: rgb(0, 102, 255); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; font-family: &quot;microsoft yahei&quot;, arial, simsun; line-height: 24px; margin: 0px; outline: rgb(0, 102, 255) none 0px; padding: 0px; text-align: left; text-decoration: none; word-break: break-all;">或在orm文件中：</span><br style="COLOR: rgb(0,102,255)"/><span style="border: 0px none rgb(0, 102, 255); color: rgb(0, 102, 255); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; font-family: &quot;microsoft yahei&quot;, arial, simsun; line-height: 24px; margin: 0px; outline: rgb(0, 102, 255) none 0px; padding: 0px; text-align: left; text-decoration: none; word-break: break-all;">&lt;class name=&quot;entity.PetInfo&quot; table=&quot;PetInfo&quot; schema=&quot;dbo&quot; catalog=&quot;epet&quot;&gt;</span><br style="COLOR: rgb(0,102,255)"/><span style="border: 0px none rgb(0, 102, 255); color: rgb(0, 102, 255); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; font-family: &quot;microsoft yahei&quot;, arial, simsun; line-height: 24px; margin: 0px; outline: rgb(0, 102, 255) none 0px; padding: 0px; text-align: left; text-decoration: none; word-break: break-all;">   &lt;cache usage=&quot;read-only&quot;/&gt;</span><br style="COLOR: rgb(0,102,255)"/><span style="border: 0px none rgb(0, 102, 255); color: rgb(0, 102, 255); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; font-family: &quot;microsoft yahei&quot;, arial, simsun; line-height: 24px; margin: 0px; outline: rgb(0, 102, 255) none 0px; padding: 0px; text-align: left; text-decoration: none; word-break: break-all;">   ...</span><br style="COLOR: rgb(0,102,255)"/><span style="border: 0px none rgb(0, 102, 255); color: rgb(0, 102, 255); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; font-family: &quot;microsoft yahei&quot;, arial, simsun; line-height: 24px; margin: 0px; outline: rgb(0, 102, 255) none 0px; padding: 0px; text-align: left; text-decoration: none; word-break: break-all;">&lt;/class&gt;</span><br style="COLOR: rgb(0,102,255)"/><br style="COLOR: rgb(0,102,255)"/><span style="border: 0px none rgb(0, 102, 255); color: rgb(0, 102, 255); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; font-family: &quot;microsoft yahei&quot;, arial, simsun; line-height: 24px; margin: 0px; outline: rgb(0, 102, 255) none 0px; padding: 0px; text-align: left; text-decoration: none; word-break: break-all;">(5)如果需要清除二级缓存，使用下面语法</span><br style="COLOR: rgb(0,102,255)"/><span style="border: 0px none rgb(0, 102, 255); color: rgb(0, 102, 255); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; font-family: &quot;microsoft yahei&quot;, arial, simsun; line-height: 24px; margin: 0px; outline: rgb(0, 102, 255) none 0px; padding: 0px; text-align: left; text-decoration: none; word-break: break-all;">    sessionFactory.evict(User.class)  清除所有user</span><br style="COLOR: rgb(0,102,255)"/><span style="border: 0px none rgb(0, 102, 255); color: rgb(0, 102, 255); display: inline; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; font-family: &quot;microsoft yahei&quot;, arial, simsun; line-height: 24px; margin: 0px; outline: rgb(0, 102, 255) none 0px; padding: 0px; text-align: left; text-decoration: none; word-break: break-all;">    sessionFactory.evict(User.class,Id)  清除指定user</span></div></td></tr></tbody></table></div></div></div></div></span>
</div></body></html> 