<html>
<head>
  <title>手工打造一个完美的WinPE3.html</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/306387 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="913"/>
<h1>手工打造一个完美的WinPE3.html</h1>

<div>
<span><div><h1>         手工打造一个完美的WinPE3.0步骤(完美到每个细节)</h1></div><div><div style="FLOAT: left;width: 356px;HEIGHT: 290px;"><ins style="display:inline-block;width:336px;height:280px"><ins style="display: inline-table; border: none; height: 280px; margin: 0px; padding: 0px; position: relative; visibility: visible; width: 336px;"><ins style="display: block; border: none; height: 280px; margin: 0px; padding: 0px; position: relative; visibility: visible; width: 336px;"></ins></ins></ins></div><p>WinPE，全称Windows Preinstallation Environment即Windows预安装环境，它不是一个常规用途的操作系统，无法作为日常工作使用，而是常作为安装、故障排除和恢复的一种工具。 下面高手就来教教大家如何自己动手来制作一个完美的WinPE3.0。</p><p><strong>一、具体制作方法：</strong></p><p>1、把windows7光盘（或光盘镜像）里的/sources/boot.wim文件复制到d：/winpe/sources目录</p><p>2、在附件提供imgaex目录里右键点击inf文件，选安装。（Imagex 6.0 AIK 封装工具）</p><p>3、运行cmd，进入imgaex目录。</p><p>4、imagex /mountrw d：/winpe/sources/boot.wim 2 d：/winpe/new （将d：/winpe/sources/boot.wim镜像映射到d：/winpe/new目录）</p><p>5、删除d：/winpe/new根目录下的setup.exe文件。删除sources文件夹，很重要，可以精简winpe哟。</p><p>6、imagex /unmount /commit d：/winpe/new （合并对d：/winpe/new目录中映像文件的修改，并将其卸载）</p><p>7、imagex /compress maximum /export “d：/winpe/sources/boot.wim” 2 “d：/winpe/pe3/boot.wim”，把boot.wim分离并重新压缩。</p><p>7、d：/winpe/pe3/boot.wim即为修改后的镜像。这个时候运行这个映像winpe是默认的“命令提示符”窗口。</p><p><strong>二、制作PE光盘镜像：</strong></p><p>1. 新建d：/winpe/pe，新建d：/winpe/pe/sources</p><p>2. 复制（windows7光盘为X）X：/boot目录（包括文件）到d：/winpe/pe</p><p>复制X：/efi目录（包括文件）到d：/winpe/pe</p><p>复制X：/bootmgr文件到d：/winpe/pe</p><p>复制修改后的boot.wim文件到d：/winpe/pe/sources（X为windows7光盘符）</p><p>3. 用UltraISO提取windows7光盘引导文件，保存为windows7.bif</p><p>4. 用UltraISO将d：/winpe/pe下的目录和文件添加到光盘镜像，加载windows7.bif，保存镜像为PE 3.0.iso</p><p><strong>三、图像shell（下面内容来自M$）</strong></p><p>Winpeshl.ini 可控制是否将自定义外壳程序加载到 Windows PE 而不是默认的“命令提示符”窗口。若要加载自定义外壳程序，请创建一个名为 Winpeshl.ini 的文件，然后将它放在自定义 Windows PE 映像的 %SYSTEMROOT%“System32 中。该 .ini 文件必须包含以下部分和项：</p><p><strong>［LaunchApp］</strong></p><p>AppPath = %SYSTEMDRIVE%”myshell.exe</p><p><strong>［LaunchApps］</strong></p><p>%SYSTEMDRIVE%“mydir”application1.exe， -option1 -option2</p><p>application2.exe， -option1 -option2</p><p>将 AppPath 项设置为外壳应用程序的路径。该路径可以是完全限定路径，您也可以使用环境变量（例如 %SYSTEMROOT%“System32”Myshell.exe）来表示该路径。AppPath 项不支持命令行选项。</p><p>使用 ［LaunchApps］ 部分运行带命令行选项的应用程序。应用程序按照列出的顺序运行；应用程序的名称及其选项以逗号分隔。</p><p>当退出“命令提示符”窗口或自定义外壳应用程序时，Windows PE 将重新启动。</p><p><strong>重要事项：</strong></p><p>不要编辑 Setupreg.hiv 的 HKEY_LOCAL_MACHINE/SYSTEM/Setup 注册表项中的 CmdLine 值来启动外壳应用程序。CmdLine 的值可调用 Winpeshl.exe，Winpeshl.exe 会执行很多函数，包括调用 Windows PE 中的默认“命令提示符”窗口或您的自定义外壳应用程序。</p><p><strong>举例：</strong>用bsexplorer制作自制版WindowsPE，从网上下载bsexplorer程序，从CMD到 imagex目录：imagex /mountrw d：/winpe/sources/boot.wim 1 d：/winpe/new，解压bsexplorer后连同文件夹一起放到d：/winpe/new/windows目录中，把上面建的 Winpeshl.ini，里面要指出bsexplorer.exe所在的路径，放到d：/winpe/new/windows/system32中。</p><p><strong>定义：</strong></p><p><strong>【bs_desktop.ini】</strong></p><p>这个文件是用来自定义PE的桌面快捷方式的，第一行的 ［Desktop CFG file Ver.1］ 必须保留。</p><p><strong>格式：</strong></p><p>《-ItemBegin-》</p><p>ItemX=</p><p>ItemY=</p><p>Caption=</p><p>ExeName=</p><p>IconName=</p><p>IconNumber=</p><p>ExeDir=</p><p>CmdParam=</p><p>ShowState=</p><p>《-ItemEnd-》</p><p><strong>举例：</strong></p><p>《-ItemBegin-》</p><p>ItemX=20</p><p>ItemY=20</p><p>Caption=资源管理器</p><p>ExeName=%SystemDrive%/Program files/A43/A43.exe</p><p>IconName=%SystemDrive%/Program files/A43/A43.ico</p><p>IconNumber=0</p><p>ExeDir=%SystemDrive%/Program files/A43</p><p>CmdParam=</p><p>ShowState=NORMAL</p><p>《-ItemEnd-》</p><p><strong>参数说明：</strong></p><p>每一个左边上的图标都是由这样的一段配置生成的，每个图标开头和结尾必须有 《-ItemBegin-》 和 《-ItemEnd-》 ， ItemX= 是指图标的横向距离，默认第一列为 20 ，第二列为 100 ，第三列为 180 ，以此类推（每下一列的值都比前一列增加 80 ，这是默认的设置，可以自由修改，但这是最好的设计了）。 ItemY 和 ItemX= 一样，但指的是横向坐标（即行数）。 Caption 填什么都可以，支持中文，是图标下的名称文字。 ExeName则是目标文件或程序的路径（要求包括扩展名，可以不是绝对路径。允许使用系统变量）。 IconName 是此快捷方式的图标路径， IconNumber 是此图标文件中的第几个图标，默认为 0 。 ExeDir 是此文件或程序的运行路径。 CmdParam 是专门应用于这个程序的启动（命令行）参数（例如 Nero StartSmart Essentials 的启动参数是 -ScParameter=8 ），大部分大型软件都有用到。 ShowState 是目标的显示方式，默认为 NORMAL ，在此参数下打开窗口不会有任何变化，仍然是原样。</p><p><strong>【bs_logon.ini】</strong></p><p>这个文件是用来自定义PE的登录方式的，这里只讲解 ［Shell］ 部分， ［Shell］ 此行必须保留。</p><p><strong>格式：</strong></p><p>=</p><p><strong>举例：</strong></p><p>BS图形界面=%SystemDrive%/Program Files/BsExplorer/explorer.exe</p><p>参数说明： = 之前的内容为登陆框下拉菜单中的显示文字（允许空格和汉字），之后的内容为一个PE Shell的路径，其实就是一个可执行程序，但是如果只打开一个普通应用程序的话就不会打开桌面，当此程序结束时会退回登录对话框。无论 ［Shell］ 下面的内容你删去了什么，举例中的那行一定要保留，否则下拉菜单中不会出现 BS图形界面项，自然也无法进入桌面了。</p><p><strong>【bs_qlaunch.ini】</strong></p><p>这个文件是用来自定义PE的快速启动栏的，第一行的 ［QLaunch CFG file Ver.1］ 必须保留。</p><p><strong>格式：</strong></p><p>《-ItemBegin-》</p><p>Caption=</p><p>ExeName=</p><p>IconNumber=</p><p>《-ItemEnd-》</p><p><strong>举例：</strong></p><p>《-ItemBegin-》</p><p>Caption=显示桌面</p><p>ExeName=@ShowDesktop</p><p>IconNumber=20</p><p>《-ItemEnd-》</p><p><strong>参数说明：</strong>与 bs_desktop.ini 文件一样，就是参数少了点。</p><p><strong>【bs_menuimg.bmp】</strong></p><p>这个文件中保存着需要用到的一些常见的小程序图标（16×16），此文章中所有的 IconNumber= 都指向这里，所以比较重要。第一个编号为 0，第二个编号为 1 ，以此类推，您可按照16×16的大小添加或修改图标。</p><p><strong>【bs_explorer.ini】</strong></p><p>这个文件中只有几个需要特别讲解的地方：</p><p>DesktopBkgndText= 显示在桌面右下角的文字，颜色默认为白色，可自由修改，值为空时会显示一段版权说明。</p><p>DesktopTextColor= 规定了桌面上的文字颜色，格式为十六进制颜色数值，默认为 $00ffffff 。</p><p>DesktopTextBkColor= 规定了桌面上的文字的背景色，格式为十六进制颜色数值，默认为 $ffffffFF 。</p><p>其它可能有用的参数（不做详细解释）：</p><p>NoCheckFiles= 不检查文件，默认为 YES 。</p><p>NoStartMenuIcon= 无开始菜单图标，默认为 NO 。</p><p>NoStartMenuMargin= 无开始菜单边缘空白，默认为 NO 。</p><p>NoDesctopIcon= 不显示桌面快捷方式，默认为 NO 。</p><p>NoQlaunchBar= 不显示快速启动栏，默认为 NO 。</p><p><strong>【BS_START.INI】</strong></p><p>这个文件是最重要的！它规定了开始菜单中的内容。</p><p><strong>格式：</strong></p><p>《-ItemBegin-》</p><p>ShowInAutorun=</p><p>EnableInAutorun=</p><p>ParentItem=</p><p>Caption=</p><p>ExeName=</p><p>IconNumber=</p><p>ExeDir=</p><p>ShowState=</p><p>《-ItemEnd-》</p><p><strong>举例：</strong></p><p>《-ItemBegin-》</p><p>ShowInAutorun=YES</p><p>EnableInAutorun=YES</p><p>ParentItem=office</p><p>Caption=Word</p><p>ExeName=%SystemDrive%/program files/Office97/WORD.EXE</p><p>IconNumber=45</p><p>ExeDir=%SystemDrive%/program files/Office97</p><p>ShowState=NORMAL</p><p>《-ItemEnd-》</p><p><strong>参数说明：</strong> ShowInAutorun= 和 EnableInAutorun= 两项好像基本在我的自定义实验中并没有什么用处，所以不做讲解。大部分参数都与以上介绍的几个文件相同，ParentItem= 是指向此快捷方式放入哪个文件夹（如果要放到开始菜单的根目录下的话，就需要写入 root ）。建立文件夹的格式为：</p><p>《-ItemBegin-》</p><p>ShowInAutorun=YES</p><p>EnableInAutorun=YES</p><p>ParentItem=programs</p><p>Caption=Office 97</p><p>MenuId=office</p><p>《-ItemEnd-》</p><p>MenuId 是一个唯一的标识，普通快捷方式的 ParentItem= 指向的就是这里。</p><p>同样需要特殊说明的是建立分隔线，格式为：</p><p>《-ItemBegin-》</p><p>ShowInAutorun=YES</p><p>EnableInAutorun=YES</p><p>ParentItem=root</p><p>Caption=-</p><p>《-ItemEnd-》</p><p>同样， ParentItem= 的值属性同上（译为：“母物品”）。</p><p>imagex /unmount /commit d：/winpe/new</p><p>imagex /compress maximum /export “d：/winpe/sources/boot.wim” 1 “d：/winpe/pe3/boot.wim”</p><p>然后把boot.wim放到d：/winpe/pe/sources中，用Ultraiso制作ISO文件（步骤同上）。</p><p>至此，一个完美的WinPE3.0就制作完成了，用户可以把制作好的WinPE3.0安装在Windows系统内，这样一来，系统遇到紧急故障时就可以通过这个来进行修复了。</p><br/><div style="color:gray"><small>来源： &lt;<a href="http://www.kafan.cn/edu/5205412.html">http://www.kafan.cn/edu/5205412.html</a><small>&gt;</small></small></div><small><small> </small></small></div></span>
</div></body></html> 